<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/x-icon" href="images/mdai_icon.ico">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MDai Registration System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
     * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #667eea, #764ba2);
      padding: 20px;
      overflow-x: hidden;
      animation: bodyFade 1s ease forwards;
    }
    @keyframes bodyFade {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 20px;
      max-width: 1000px;
      margin: auto;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
      animation: zoomIn 1s ease forwards;
    }
    @keyframes zoomIn {
      from { transform: scale(0.95); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    h1, h2 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
      animation: slideInDown 1s ease;
    }
    @keyframes slideInDown {
      from { transform: translateY(-40px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .tabs {
      text-align: center;
      margin-bottom: 25px;
    }
    .tabs button {
      padding: 12px 30px;
      border: none;
      margin: 0 10px;
      cursor: pointer;
      font-weight: bold;
      border-radius: 8px;
      background: linear-gradient(to right, #00c6ff, #0072ff);
      color: white;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .tabs button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
    }
    form input, form select {
      margin-bottom: 15px;
      padding: 12px;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-size: 16px;
      transition: 0.3s;
    }
    form input:focus, form select:focus {
      border-color: #007bff;
      outline: none;
      box-shadow: 0 0 8px rgba(0,123,255,0.2);
    }
    .form-section {
      margin-bottom: 25px;
    }
    .phone-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .tab-content {
      display: none;
      animation: fadeIn 0.8s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      overflow-x: auto;
      display: block;
    }
    table thead, table tbody, table th, table td, table tr {
      display: block;
    }
    thead {
      background: #222;
      color: white;
    }
    table thead tr {
      display: flex;
      flex-wrap: nowrap;
    }
    table tbody tr {
      display: flex;
      flex-wrap: wrap;
      border-bottom: 1px solid #ccc;
      transition: background 0.3s;
    }
    table tbody tr:hover {
      background: #f1f1f1;
    }
    table th, table td {
      flex: 1;
      padding: 10px;
      text-align: center;
      font-size: 14px;
      min-width: 120px;
    }
    #regNumber {
      font-weight: bold;
      color: green;
      margin: 10px 0;
    }
    button[type="submit"] {
      background: linear-gradient(to right, #28a745, #218838);
      color: white;
      border: none;
      padding: 14px;
      width: 100%;
      font-size: 16px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.3s, background 0.3s;
    }
    button[type="submit"]:hover {
      background: #1e7e34;
      transform: scale(1.02);
    }
    #preview {
      display: block;
      margin-bottom: 10px;
      max-width: 100px;
      border-radius: 10px;
    }
    #searchInput {
      margin: 10px 0;
      padding: 12px;
      width: 100%;
      border-radius: 10px;
      border: 1px solid #ccc;
    }
    .message-box {
      text-align: center;
      margin-top: 20px;
      padding: 20px;
      border-radius: 15px;
      background: linear-gradient(135deg, #a1ffce, #faffd1);
      color: #004085;
      font-size: 1.2em;
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
      animation: bounceIn 0.8s ease;
      display: none;
    }
    @keyframes bounceIn {
      0% { transform: scale(0.9); opacity: 0; }
      60% { transform: scale(1.05); }
      100% { transform: scale(1); opacity: 1; }
    }
    @media (min-width: 768px) {
      table thead, table tbody, table tr {
        display: table-row-group;
      }
      table thead tr, table tbody tr {
        display: table-row;
      }
      table th, table td {
        display: table-cell;
        min-width: auto;
      }
    }



    .alert-box {
      position: fixed;
      top: 30px;
      right: 30px;
      background: linear-gradient(to right, #ff6a00, #ee0979);
      color: white;
      padding: 15px 20px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      font-size: 16px;
      z-index: 1000;
      display: none;
      animation: slideInRight 0.5s ease forwards;
    }
    @keyframes slideInRight {
      from { transform: translateX(100px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Système d'inscription MDai</h1>
    <div class="tabs">
      <button onclick="showTab('user')">Utilisateur</button>
      <button onclick="loginAdmin()">Administrateur</button>
    </div>
    <div id="user" class="tab-content">
      <form id="regForm">
        <div class="form-section">
          <label>Nom d'utilisateur :</label>
          <input type="text" id="username" required>
          <label>Email :</label>
          <input type="email" id="email" required>
          <label>Téléphone :</label>
          <div class="phone-group">
            <select id="countryCode">
              <option value="+91">🇮🇳 +91</option>
              <option value="+243">🇨🇩 +243</option>
              <option value="+254">🇰🇪 +254</option>
            </select>
            <input type="tel" id="phone" required>
          </div>
          <label>Pays :</label>
          <select id="country">
            <option value="India">🇮🇳 Inde</option>
            <option value="Congo">🇨🇩 Congo</option>
            <option value="Kenya">🇰🇪 Kenya</option>
          </select>
        </div>
        <div class="form-section">
          <label>Cours :</label>
          <select id="course" required>
            <option value="web">Développement Web</option>
            <option value="excel">Excel</option>
            <option value="python">Python</option>
            <option value="cprog">Langage C</option>
            <option value="photoshop">Photoshop</option>
            <option value="english">Anglais</option>
          </select>
          <label>Langue préférée :</label>
          <select id="language">
            <option value="English">Anglais</option>
            <option value="French">Français</option>
          </select>
          <label>Comment avez-vous connu MDai ?</label>
          <select id="referrer">
            <option>Ami</option>
            <option>Internet</option>
            <option>Je préfère ne pas le dire</option>
          </select>
          <label>Méthode de paiement :</label>
          <select id="payment" required>
            <option value="M-Pesa">M-Pesa</option>
            <option value="Paytm">Paytm</option>
            <option value="Virement Bancaire">Virement Bancaire</option>
            <option value="Airtel Money">Airtel Money</option>
            <option value="Orange Money">Orange Money</option>
            <option value="Carte Bancaire">Carte Bancaire</option>
          </select>
        </div>
        <div class="form-section">
          <label>Photo de profil :</label>
          <input type="file" id="photo" accept="image/*">
          <img id="preview" style="display: none" />
          <p id="regNumber"></p>
        </div>
        <button type="submit">S'inscrire</button>
      </form>
       <div id="alert" class="alert-box"></div>
      <div id="successMessage" class="message-box"></div>
    </div>
<div id="admin" class="tab-content">
      <h2>Panneau Administrateur</h2>
      <input type="text" id="searchInput" placeholder="Recherche...">
      <button onclick="exportCSV()">Exporter CSV</button>
      <table id="dataTable">
        <thead>
          <tr>
            <th>N°</th><th>Nom</th><th>Email</th><th>Téléphone</th><th>Pays</th>
            <th>Cours</th><th>Langue</th><th>Source</th><th>Paiement</th>
            <th>Présence</th><th>%</th><th>Action</th><th>Éditer</th><th>Supprimer</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

 <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, updateDoc, doc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getStorage, ref, uploadString, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDItyYqBdyYlUnxX4uzoMOLPWiR5lXqogs",
      authDomain: "mdai-registration.firebaseapp.com",
      projectId: "mdai-registration",
      storageBucket: "mdai-registration.appspot.com",
      messagingSenderId: "1069482771907",
      appId: "1:1069482771907:web:41f78081169ca819462976"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    window.showTab = (tab) => {
      document.getElementById("user").style.display = tab === "user" ? "block" : "none";
      document.getElementById("admin").style.display = tab === "admin" ? "block" : "none";
    };

    window.loginAdmin = () => {
      const pass = prompt("Enter Admin Password:");
      if (pass === "admin123") {
        showTab("admin");
        alert("Admin access granted ✅");
      } else {
        alert("Access Denied ❌");
      }
    };

    function generateRegNumber(courseCode) {
      const rand = Math.floor(1000 + Math.random() * 9000);
      return `MDai${courseCode}${rand}`;
    }

    document.getElementById("regForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const courseCode = document.getElementById("course").value;
      const regNumber = generateRegNumber(courseCode);
      const photoFile = document.getElementById("preview").src;
      let photoURL = "";
      if (photoFile) {
        const storageRef = ref(storage, `photos/${regNumber}.jpg`);
        await uploadString(storageRef, photoFile, 'data_url');
        photoURL = await getDownloadURL(storageRef);
      }

      const user = { regNumber, username: username.value, email: email.value, phone: countryCode.value + phone.value, country: country.value, course: course.value, language: language.value, referrer: referrer.value, payment: payment.value, attendance: 0, total: 0, photo: photoURL };

      await addDoc(collection(db, "users"), user);
      document.getElementById("successMessage").innerHTML = `<strong>Welcome!</strong> Registration successful.`;
      document.getElementById("successMessage").style.display = 'block';
      regForm.reset();
    });

    const tbody = document.querySelector("#dataTable tbody");
    const searchInput = document.getElementById("searchInput");

    function renderUsers(snapshot) {
      tbody.innerHTML = "";
      const filter = searchInput.value.toLowerCase();
      snapshot.forEach((docSnap) => {
        const u = docSnap.data();
        const searchString = `${u.regNumber} ${u.username} ${u.email} ${u.course} ${u.phone} ${u.country}`.toLowerCase();
        if (!filter || searchString.includes(filter)) {
          const percent = u.total > 0 ? ((u.attendance / u.total) * 100).toFixed(1) : "0";
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${u.regNumber}</td>
            <td>${u.username}</td>
            <td>${u.email}</td>
            <td>${u.phone}</td>
            <td>${u.country}</td>
            <td>${u.course}</td>
            <td>${u.language}</td>
            <td>${u.referrer}</td>
            <td>${u.payment}</td>
            <td>${u.attendance}</td>
            <td>${percent}%</td>
            <td>
              <button onclick="markAttendance('${docSnap.id}', true)">+</button>
              <button onclick="markAttendance('${docSnap.id}', false)">-</button>
            </td>
            <td><button onclick="editUser('${docSnap.id}', '${u.username}')">✏️</button></td>
            <td><button onclick="deleteUser('${docSnap.id}')">🗑️</button></td>`;
          tbody.appendChild(tr);
        }
      });
    }

    const unsubscribe = onSnapshot(collection(db, "users"), (snapshot) => renderUsers(snapshot));
    searchInput.addEventListener("input", () => {
      getDocs(collection(db, "users")).then(renderUsers);
    });

    window.markAttendance = async (id, isPresent) => {
      const docRef = doc(db, "users", id);
      const snapshot = await getDocs(collection(db, "users"));
      const current = snapshot.docs.find(d => d.id === id).data();
      await updateDoc(docRef, { attendance: current.attendance + (isPresent ? 1 : 0), total: current.total + 1 });
    };

    window.editUser = async (id, oldName) => {
      const newName = prompt("Edit Username:", oldName);
      if (newName) await updateDoc(doc(db, "users", id), { username: newName });
    };

    window.deleteUser = async (id) => {
      if (confirm("Delete user?")) await deleteDoc(doc(db, "users", id));
    };

    window.exportCSV = async () => {
      const snapshot = await getDocs(collection(db, "users"));
      let csv = "Reg No,Username,Email,Phone,Country,Course,Language,Referrer,Payment,Attendance,Total,%\n";
      snapshot.forEach((docSnap) => {
        const u = docSnap.data();
        const percent = u.total > 0 ? ((u.attendance / u.total) * 100).toFixed(1) : "0";
        csv += `${u.regNumber},${u.username},${u.email},${u.phone},${u.country},${u.course},${u.language},${u.referrer},${u.payment},${u.attendance},${u.total},${percent}%\n`;
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'mdai_users.csv';
      link.click();
    };

    showTab("user");
  </script>
</body>
</html>





 


