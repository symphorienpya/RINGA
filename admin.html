<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - MDai</title>
    <link rel="icon" type="image/png" href="images/AI.png" />
    <link rel="shortcut icon" type="image/png" href="images/AI.png" />
    <link rel="apple-touch-icon" href="images/AI.png" />

    <!-- Modern Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Icons -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      :root {
        /* Modern Color Palette from index.html */
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --accent-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --dark-gradient: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);

        --primary-color: #667eea;
        --secondary-color: #f093fb;
        --accent-color: #4facfe;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --error-color: #ef4444;
        --info-color: #3b82f6;

        /* Dark Theme Colors */
        --text-primary: #ffffff;
        --text-secondary: #b4b4b4;
        --text-muted: #9ca3af;
        --background-dark: #0a0a0a;
        --background-card: rgba(255, 255, 255, 0.05);
        --background-sidebar: rgba(10, 10, 10, 0.95);
        --border-color: rgba(255, 255, 255, 0.1);
        --border-light: rgba(255, 255, 255, 0.05);

        /* Shadows */
        --shadow-soft: 0 10px 40px rgba(0, 0, 0, 0.15);
        --shadow-hard: 0 20px 60px rgba(0, 0, 0, 0.3);
        --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.25);
        --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.4);
        --glow: 0 0 30px rgba(102, 126, 234, 0.3);

        /* Spacing */
        --spacing-sm: 0.5rem;
        --spacing-md: 1rem;
        --spacing-lg: 1.5rem;
        --spacing-xl: 2rem;

        /* Border Radius */
        --radius-sm: 0.375rem;
        --radius-md: 0.75rem;
        --radius-lg: 1rem;
        --radius-xl: 1.5rem;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: var(--light-gray);
        color: var(--text-primary);
        line-height: 1.6;
      }

      .admin-container {
        display: flex;
        min-height: 100vh;
      }

      /* Sidebar */
      .sidebar {
        width: 280px;
        background: var(--background-sidebar);
        backdrop-filter: blur(20px);
        border-right: 1px solid var(--border-color);
        box-shadow: var(--shadow-hard);
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        z-index: 1000;
      }

      .sidebar-header {
        padding: var(--spacing-lg);
        border-bottom: 1px solid var(--border-color);
        background: var(--primary-gradient);
        position: relative;
      }

      .sidebar-header::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
      }

      .logo {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        font-family: "Space Grotesk", sans-serif;
        letter-spacing: -0.02em;
      }

      .nav-menu {
        list-style: none;
        padding: var(--spacing-lg) var(--spacing-md);
      }

      .nav-item {
        margin-bottom: var(--spacing-sm);
      }

      .nav-link {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        padding: var(--spacing-md) var(--spacing-lg);
        text-decoration: none;
        color: var(--text-secondary);
        border-radius: var(--radius-md);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        font-weight: 500;
      }

      .nav-link::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: var(--accent-gradient);
        transition: left 0.3s ease;
        z-index: -1;
      }

      .nav-link:hover::before,
      .nav-link.active::before {
        left: 0;
      }

      .nav-link:hover,
      .nav-link.active {
        color: var(--text-primary);
        transform: translateX(5px);
        box-shadow: var(--shadow-md);
      }

      .nav-link i {
        font-size: 1.1rem;
        width: 20px;
        text-align: center;
      }

      /* Main Content */
      .main-content {
        flex: 1;
        margin-left: 280px;
        padding: var(--spacing-xl);
        background: rgba(255, 255, 255, 0.02);
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-xl);
        padding: var(--spacing-lg);
        background: var(--background-card);
        backdrop-filter: blur(20px);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-soft);
      }

      .page-title {
        font-size: 2.5rem;
        font-weight: 800;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-family: "Space Grotesk", sans-serif;
        letter-spacing: -0.02em;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        color: var(--text-secondary);
      }

      .user-avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: var(--accent-gradient);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        box-shadow: var(--glow);
        border: 2px solid rgba(255, 255, 255, 0.1);
      }

      /* Dashboard Grid */
      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: var(--spacing-lg);
        margin-bottom: var(--spacing-xl);
      }

      .card {
        background: var(--background-card);
        backdrop-filter: blur(20px);
        border-radius: var(--radius-lg);
        padding: var(--spacing-lg);
        box-shadow: var(--shadow-hard);
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: var(--accent-gradient);
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
        border-color: rgba(79, 172, 254, 0.3);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-md);
      }

      .card-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
      }

      .card-title i {
        color: var(--accent-color);
      }

      .stat-card {
        text-align: center;
        background: var(--background-card);
        backdrop-filter: blur(20px);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .stat-card::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
      }

      .stat-number {
        font-size: 3rem;
        font-weight: 800;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: var(--spacing-sm);
        font-family: "Space Grotesk", sans-serif;
      }

      .stat-label {
        color: var(--text-secondary);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.875rem;
      }

      /* Table */
      .table-container {
        background: var(--background-card);
        backdrop-filter: blur(20px);
        border-radius: var(--radius-lg);
        overflow: hidden;
        box-shadow: var(--shadow-hard);
        border: 1px solid var(--border-color);
      }

      .table {
        width: 100%;
        border-collapse: collapse;
      }

      .table th,
      .table td {
        padding: var(--spacing-md);
        text-align: left;
        border-bottom: 1px solid var(--border-light);
      }

      .table th {
        background: linear-gradient(
          135deg,
          rgba(102, 126, 234, 0.1),
          rgba(79, 172, 254, 0.1)
        );
        font-weight: 600;
        color: var(--text-primary);
        position: sticky;
        top: 0;
        z-index: 10;
        backdrop-filter: blur(10px);
      }

      .table th i {
        color: var(--accent-color);
        margin-right: 8px;
      }

      .table tbody tr {
        transition: all 0.3s ease;
      }

      .table tbody tr:hover {
        background: rgba(102, 126, 234, 0.05);
        transform: scale(1.01);
      }

      /* Buttons */
      .btn {
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-md) var(--spacing-lg);
        border: none;
        border-radius: var(--radius-md);
        font-weight: 500;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        font-size: 0.9rem;
      }

      .btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      .btn:hover::before {
        left: 100%;
      }

      .btn-primary {
        background: var(--primary-gradient);
        color: white;
        box-shadow: var(--shadow-soft);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--glow);
      }

      .btn-secondary {
        background: var(--background-card);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
        backdrop-filter: blur(20px);
      }

      .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: var(--accent-color);
        transform: translateY(-2px);
      }

      /* Modal Styles */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(20px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.4s ease;
      }

      .modal.active {
        opacity: 1;
        visibility: visible;
      }

      .modal-content {
        background: var(--background-card);
        backdrop-filter: blur(30px);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-xl);
        padding: var(--spacing-xl);
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: var(--shadow-hard);
        transform: translateY(-50px);
        transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        position: relative;
      }

      .modal-content::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: var(--accent-gradient);
        border-radius: var(--radius-xl) var(--radius-xl) 0 0;
      }

      .modal.active .modal-content {
        transform: translateY(0);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
        padding-bottom: var(--spacing-md);
        border-bottom: 1px solid var(--border-color);
      }

      .modal-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
      }

      .close-modal {
        background: none;
        border: none;
        font-size: 1.5rem;
        color: var(--text-secondary);
        cursor: pointer;
        padding: var(--spacing-sm);
        border-radius: 50%;
        transition: all 0.2s ease;
      }

      .close-modal:hover {
        background: var(--light-gray);
        color: var(--text-primary);
      }

      /* Form Styles */
      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-lg);
      }

      .form-group {
        margin-bottom: var(--spacing-md);
      }

      .form-label {
        display: block;
        margin-bottom: var(--spacing-sm);
        font-weight: 500;
        color: var(--text-primary);
      }

      .form-input,
      .form-select {
        width: 100%;
        padding: var(--spacing-md);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        font-size: 1rem;
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-primary);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      }

      .form-input::placeholder {
        color: var(--text-secondary);
      }

      .form-input:focus,
      .form-select:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        background: rgba(255, 255, 255, 0.08);
        transform: translateY(-1px);
      }

      /* Enhanced Button Styles */
      .btn-group {
        display: flex;
        gap: var(--spacing-sm);
        justify-content: flex-end;
        margin-top: var(--spacing-lg);
      }

      .btn-icon {
        padding: var(--spacing-sm);
        width: auto;
        min-width: 40px;
        height: 40px;
        border-radius: var(--radius-md);
        font-size: 0.875rem;
      }

      .btn-success {
        background: linear-gradient(135deg, var(--success-color), #059669);
        color: white;
        border: none;
      }

      .btn-success:hover {
        background: linear-gradient(135deg, #059669, #047857);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      .btn-danger {
        background: linear-gradient(135deg, var(--error-color), #dc2626);
        color: white;
        border: none;
      }

      .btn-danger:hover {
        background: linear-gradient(135deg, #dc2626, #b91c1c);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      .btn-warning {
        background: linear-gradient(135deg, var(--warning-color), #d97706);
        color: white;
        border: none;
      }

      .btn-warning:hover {
        background: linear-gradient(135deg, #d97706, #b45309);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      /* Enhanced Statistics Cards */
      .stat-card {
        background: linear-gradient(135deg, white, #f8fafc);
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color)
        );
      }

      .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary-color);
      }

      /* Status Badges */
      .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .status-active {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success-color);
        border: 1px solid rgba(16, 185, 129, 0.2);
      }

      .status-inactive {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning-color);
        border: 1px solid rgba(245, 158, 11, 0.2);
      }

      .status-pending {
        background: rgba(59, 130, 246, 0.1);
        color: var(--info-color);
        border: 1px solid rgba(59, 130, 246, 0.2);
      }

      /* Table Actions */
      .table-actions {
        display: flex;
        gap: var(--spacing-sm);
        justify-content: center;
      }

      /* Authentication Overlay */
      .auth-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--background-dark);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 1;
        transition: all 0.5s ease;
      }

      .auth-overlay.hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
      }

      .auth-container {
        background: var(--background-card);
        backdrop-filter: blur(30px);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-xl);
        padding: 3rem;
        width: 90%;
        max-width: 500px;
        text-align: center;
        box-shadow: var(--shadow-hard);
        position: relative;
        overflow: hidden;
        animation: slideIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }

      .auth-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
        border-radius: var(--radius-xl) var(--radius-xl) 0 0;
      }

      .auth-container::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle at 30% 70%,
            rgba(102, 126, 234, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 70% 30%,
            rgba(79, 172, 254, 0.1) 0%,
            transparent 50%
          );
        z-index: -1;
        animation: float 15s ease-in-out infinite;
      }

      @keyframes slideIn {
        from {
          transform: translateY(-100px) scale(0.8);
          opacity: 0;
        }
        to {
          transform: translateY(0) scale(1);
          opacity: 1;
        }
      }

      .auth-icon {
        width: 80px;
        height: 80px;
        background: var(--accent-gradient);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 2rem;
        box-shadow: var(--glow);
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .auth-icon i {
        font-size: 2.5rem;
        color: white;
      }

      .auth-title {
        font-size: 2rem;
        font-weight: 700;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 1rem;
        font-family: "Space Grotesk", sans-serif;
      }

      .auth-subtitle {
        color: var(--text-secondary);
        font-size: 1.1rem;
        margin-bottom: 2rem;
        line-height: 1.6;
      }

      .auth-buttons {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        justify-content: center;
      }

      .auth-btn {
        padding: 1rem 2rem;
        border: none;
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        min-width: 120px;
      }

      .auth-btn-yes {
        background: var(--primary-gradient);
        color: white;
        box-shadow: var(--shadow-soft);
      }

      .auth-btn-yes:hover {
        transform: translateY(-2px);
        box-shadow: var(--glow);
      }

      .auth-btn-no {
        background: var(--background-card);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
        backdrop-filter: blur(20px);
      }

      .auth-btn-no:hover {
        background: rgba(239, 68, 68, 0.1);
        border-color: var(--error-color);
        color: var(--error-color);
        transform: translateY(-2px);
      }

      .code-input-container {
        display: none;
        animation: fadeIn 0.5s ease;
      }

      .code-input-container.show {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .code-input {
        width: 100%;
        padding: 1.5rem;
        border: 2px solid var(--border-color);
        border-radius: var(--radius-md);
        font-size: 1.2rem;
        font-weight: 600;
        text-align: center;
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-primary);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        letter-spacing: 2px;
        font-family: "Space Grotesk", monospace;
        margin-bottom: 1.5rem;
      }

      .code-input::placeholder {
        color: var(--text-muted);
        letter-spacing: normal;
      }

      .code-input:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 4px rgba(79, 172, 254, 0.2);
        background: rgba(255, 255, 255, 0.08);
        transform: scale(1.02);
      }

      .auth-submit {
        width: 100%;
        padding: 1.2rem;
        background: var(--accent-gradient);
        color: white;
        border: none;
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .auth-submit::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        transition: left 0.5s;
      }

      .auth-submit:hover::before {
        left: 100%;
      }

      .auth-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(79, 172, 254, 0.4);
      }

      .auth-back {
        background: transparent;
        color: var(--text-secondary);
        border: none;
        padding: 0.5rem;
        cursor: pointer;
        font-size: 0.9rem;
        margin-top: 1rem;
        transition: color 0.3s ease;
      }

      .auth-back:hover {
        color: var(--text-primary);
      }

      .error-message {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: var(--error-color);
        padding: 1rem;
        border-radius: var(--radius-md);
        margin-top: 1rem;
        font-weight: 500;
        display: none;
        animation: shake 0.5s ease-in-out;
      }

      .error-message.show {
        display: block;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }

      .loading {
        display: none;
        margin: 1rem 0;
      }

      .loading.show {
        display: block;
      }

      .spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(79, 172, 254, 0.3);
        border-top: 3px solid var(--accent-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Responsive */
      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
          transition: transform 0.3s ease;
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
          padding: var(--spacing-md);
        }

        .dashboard-grid {
          grid-template-columns: 1fr;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .table-actions {
          flex-direction: column;
        }

        .search-bar {
          flex-direction: column;
          align-items: stretch;
        }

        .page-title {
          font-size: 2rem;
        }

        .header {
          flex-direction: column;
          gap: var(--spacing-md);
          text-align: center;
        }

        .auth-container {
          padding: 2rem;
          margin: 1rem;
        }

        .auth-buttons {
          flex-direction: column;
        }

        .auth-title {
          font-size: 1.5rem;
        }
      }
    </style>
  </head>

  <body>
    <!-- Authentication Overlay -->
    <div class="auth-overlay" id="authOverlay">
      <div class="auth-container">
        <div class="auth-icon">
          <i class="fas fa-shield-alt"></i>
        </div>

        <div class="auth-step" id="authStep1">
          <h1 class="auth-title">Accès Administrateur</h1>
          <p class="auth-subtitle">
            Cette zone est réservée au personnel MDai.<br />
            Êtes-vous un membre de l'équipe MDai ?
          </p>

          <div class="auth-buttons">
            <button class="auth-btn auth-btn-yes" onclick="showCodeInput()">
              <i class="fas fa-check"></i> Oui
            </button>
            <button class="auth-btn auth-btn-no" onclick="redirectToHome()">
              <i class="fas fa-times"></i> Non
            </button>
          </div>
        </div>

        <div class="code-input-container" id="codeInputContainer">
          <h2 class="auth-title">Code d'Accès</h2>
          <p class="auth-subtitle">
            Veuillez entrer le code d'accès administrateur
          </p>

          <input
            type="password"
            class="code-input"
            id="adminCode"
            placeholder="Entrez le code..."
            maxlength="10"
            autocomplete="off"
          />

          <button class="auth-submit" onclick="verifyCode()">
            <i class="fas fa-unlock"></i> Vérifier le Code
          </button>

          <div class="loading" id="loadingSpinner">
            <div class="spinner"></div>
            <p style="margin-top: 1rem; color: var(--text-secondary)">
              Vérification...
            </p>
          </div>

          <div class="error-message" id="errorMessage">
            <i class="fas fa-exclamation-triangle"></i>
            Code incorrect. Veuillez réessayer.
          </div>

          <button class="auth-back" onclick="showMainAuth()">
            <i class="fas fa-arrow-left"></i> Retour
          </button>
        </div>
      </div>
    </div>

    <div class="admin-container" id="adminContainer">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <div class="logo">
            <i class="fas fa-brain"></i>
            <span>MDai Admin</span>
          </div>
        </div>

        <nav>
          <ul class="nav-menu">
            <li class="nav-item">
              <a href="#dashboard" class="nav-link active">
                <i class="fas fa-chart-line"></i>
                <span>Dashboard</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#users" class="nav-link">
                <i class="fas fa-users"></i>
                <span>Utilisateurs</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#courses" class="nav-link">
                <i class="fas fa-book"></i>
                <span>Cours</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#analytics" class="nav-link">
                <i class="fas fa-chart-bar"></i>
                <span>Analytiques</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#settings" class="nav-link">
                <i class="fas fa-cog"></i>
                <span>Paramètres</span>
              </a>
            </li>
          </ul>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <header class="header">
          <h1 class="page-title">Dashboard</h1>
          <div class="user-info">
            <span>Admin User</span>
            <div class="user-avatar">
              <i class="fas fa-user"></i>
            </div>
          </div>
        </header>

        <!-- Dashboard Stats -->
        <div class="dashboard-grid">
          <div class="card stat-card">
            <div class="stat-number" id="dashboardActiveUsers">0</div>
            <div class="stat-label">Utilisateurs Actifs</div>
          </div>

          <div class="card stat-card">
            <div class="stat-number" id="dashboardCourses">58</div>
            <div class="stat-label">Cours Disponibles</div>
          </div>

          <div class="card stat-card">
            <div class="stat-number" id="dashboardSessions">0</div>
            <div class="stat-label">Sessions Terminées</div>
          </div>

          <div class="card stat-card">
            <div class="stat-number" id="dashboardSatisfaction">0%</div>
            <div class="stat-label">Taux de Satisfaction</div>
          </div>
        </div>

        <!-- Dynamic Content Sections -->
        <div id="dashboard-section">
          <!-- Advanced Charts Dashboard -->
          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: var(--spacing-lg);
              margin-bottom: var(--spacing-lg);
            "
          >
            <!-- Registration Trends Chart -->
            <div class="card">
              <div
                style="
                  padding: var(--spacing-lg);
                  border-bottom: 1px solid var(--border-color);
                "
              >
                <h3 class="card-title">Tendance des Inscriptions</h3>
              </div>
              <div style="padding: var(--spacing-lg)">
                <canvas
                  id="registrationTrendsChart"
                  width="400"
                  height="300"
                ></canvas>
              </div>
            </div>

            <!-- Payment Methods Chart -->
            <div class="card">
              <div
                style="
                  padding: var(--spacing-lg);
                  border-bottom: 1px solid var(--border-color);
                "
              >
                <h3 class="card-title">Méthodes de Paiement</h3>
              </div>
              <div style="padding: var(--spacing-lg)">
                <canvas
                  id="paymentMethodsChart"
                  width="400"
                  height="300"
                ></canvas>
              </div>
            </div>
          </div>

          <!-- Course Popularity Chart -->
          <div class="card" style="margin-bottom: var(--spacing-lg)">
            <div
              style="
                padding: var(--spacing-lg);
                border-bottom: 1px solid var(--border-color);
              "
            >
              <h3 class="card-title">Popularité des Cours</h3>
            </div>
            <div style="padding: var(--spacing-lg)">
              <canvas
                id="coursePopularityChart"
                width="800"
                height="400"
              ></canvas>
            </div>
          </div>

          <!-- Recent Activity Table -->
          <div class="table-container">
            <div
              style="
                padding: var(--spacing-lg);
                border-bottom: 1px solid var(--border-color);
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <h2 class="card-title">Activité en Temps Réel</h2>
              <div style="display: flex; gap: var(--spacing-sm)">
                <button
                  onclick="userManager.refreshActivityLog()"
                  class="btn btn-secondary"
                  style="font-size: 0.9rem"
                >
                  <i class="fas fa-sync-alt"></i> Actualiser
                </button>
                <button
                  onclick="userManager.clearActivityLog()"
                  class="btn btn-secondary"
                  style="font-size: 0.9rem"
                >
                  <i class="fas fa-trash"></i> Effacer
                </button>
              </div>
            </div>

            <div
              style="
                max-height: 400px;
                overflow-y: auto;
                padding: var(--spacing-md);
              "
            >
              <div id="activityFeed" class="activity-feed">
                <!-- Dynamic activity items will be loaded here -->
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div
            style="
              margin-top: var(--spacing-xl);
              display: flex;
              gap: var(--spacing-md);
            "
          >
            <button class="btn btn-primary">
              <i class="fas fa-plus"></i>
              Nouveau Cours
            </button>
            <button class="btn btn-secondary">
              <i class="fas fa-download"></i>
              Exporter Données
            </button>
            <button class="btn btn-secondary">
              <i class="fas fa-users-cog"></i>
              Gérer Utilisateurs
            </button>
          </div>
        </div>

        <!-- Users Management Section -->
        <div id="users-section" style="display: none">
          <div class="dashboard-grid">
            <div class="card stat-card">
              <div class="stat-number" id="totalUsers">0</div>
              <div class="stat-label">Total Utilisateurs</div>
            </div>

            <div class="card stat-card">
              <div class="stat-number" id="todayRegistrations">0</div>
              <div class="stat-label">Inscriptions Aujourd'hui</div>
            </div>

            <div class="card stat-card">
              <div class="stat-number" id="totalRevenue">0 FC</div>
              <div class="stat-label">Revenus Total</div>
            </div>

            <div class="card stat-card">
              <div class="stat-number" id="activeUsers">0</div>
              <div class="stat-label">Utilisateurs Actifs</div>
            </div>
          </div>

          <!-- Users Table -->
          <div class="table-container">
            <div
              style="
                padding: var(--spacing-lg);
                border-bottom: 1px solid var(--border-color);
              "
            >
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: var(--spacing-md);
                "
              >
                <h2 class="card-title">Gestion des Utilisateurs</h2>
                <div
                  style="
                    display: flex;
                    gap: var(--spacing-sm);
                    align-items: center;
                  "
                >
                  <!-- Selected Users Counter -->
                  <span
                    id="selectedCount"
                    style="
                      display: none;
                      color: var(--text-secondary);
                      font-size: 0.9rem;
                      margin-right: var(--spacing-sm);
                    "
                  >
                    <i class="fas fa-check-square"></i>
                    <span id="selectedCountText">0</span> sélectionné(s)
                  </span>

                  <!-- Bulk Actions (hidden by default) -->
                  <div
                    id="bulkActions"
                    style="display: none; gap: var(--spacing-sm)"
                  >
                    <button
                      class="btn btn-warning"
                      onclick="userManager.bulkUpdateStatus()"
                    >
                      <i class="fas fa-edit"></i> Modifier Statut
                    </button>
                    <button
                      class="btn btn-danger"
                      onclick="userManager.bulkDelete()"
                    >
                      <i class="fas fa-trash-alt"></i> Supprimer Sélection
                    </button>
                    <button
                      class="btn btn-info"
                      onclick="userManager.bulkExport()"
                    >
                      <i class="fas fa-file-export"></i> Exporter Sélection
                    </button>
                  </div>

                  <!-- Regular Actions -->
                  <button class="btn btn-secondary" onclick="exportUsers()">
                    <i class="fas fa-download"></i> Exporter Tout
                  </button>
                  <button class="btn btn-primary" onclick="refreshUsers()">
                    <i class="fas fa-sync-alt"></i> Actualiser
                  </button>
                </div>
              </div>

              <!-- Advanced Search and Filters -->
              <div
                class="search-filter-container"
                style="
                  display: grid;
                  grid-template-columns: 1fr 200px 200px 150px auto;
                  gap: var(--spacing-sm);
                  align-items: center;
                  background: rgba(255, 255, 255, 0.02);
                  padding: var(--spacing-md);
                  border-radius: var(--radius-md);
                  border: 1px solid var(--border-color);
                "
              >
                <!-- Search Input -->
                <div style="position: relative">
                  <input
                    type="text"
                    id="searchInput"
                    placeholder="Rechercher par nom, email, cours..."
                    style="
                      width: 100%;
                      padding: 10px 40px 10px 12px;
                      border: 1px solid var(--border-color);
                      border-radius: var(--radius-sm);
                      background: var(--surface-color);
                      color: var(--text-primary);
                      font-size: 0.9rem;
                    "
                    oninput="userManager.filterUsers()"
                  />
                  <i
                    class="fas fa-search"
                    style="
                      position: absolute;
                      right: 12px;
                      top: 50%;
                      transform: translateY(-50%);
                      color: var(--text-secondary);
                    "
                  ></i>
                </div>

                <!-- Course Filter -->
                <select
                  id="courseFilter"
                  onchange="userManager.filterUsers()"
                  style="
                    padding: 10px 12px;
                    border: 1px solid var(--border-color);
                    border-radius: var(--radius-sm);
                    background: var(--surface-color);
                    color: var(--text-primary);
                    font-size: 0.9rem;
                  "
                >
                  <option value="">Tous les cours</option>
                  <option value="Formation Python">Python</option>
                  <option value="Formation JavaScript">JavaScript</option>
                  <option value="Formation Web Design">Web Design</option>
                  <option value="Formation Data Science">Data Science</option>
                </select>

                <!-- Payment Method Filter -->
                <select
                  id="paymentFilter"
                  onchange="userManager.filterUsers()"
                  style="
                    padding: 10px 12px;
                    border: 1px solid var(--border-color);
                    border-radius: var(--radius-sm);
                    background: var(--surface-color);
                    color: var(--text-primary);
                    font-size: 0.9rem;
                  "
                >
                  <option value="">Toutes méthodes</option>
                  <option value="PayPal">PayPal</option>
                  <option value="Google Pay">Google Pay</option>
                  <option value="M-Pesa">M-Pesa</option>
                  <option value="Carte Bancaire">Carte Bancaire</option>
                  <option value="Virement">Virement</option>
                </select>

                <!-- Status Filter -->
                <select
                  id="statusFilter"
                  onchange="userManager.filterUsers()"
                  style="
                    padding: 10px 12px;
                    border: 1px solid var(--border-color);
                    border-radius: var(--radius-sm);
                    background: var(--surface-color);
                    color: var(--text-primary);
                    font-size: 0.9rem;
                  "
                >
                  <option value="">Tous statuts</option>
                  <option value="Actif">Actif</option>
                  <option value="Inactif">Inactif</option>
                </select>

                <!-- Clear Filters Button -->
                <button
                  onclick="userManager.clearFilters()"
                  class="btn btn-secondary"
                  style="
                    padding: 10px 12px;
                    font-size: 0.9rem;
                    white-space: nowrap;
                  "
                >
                  <i class="fas fa-times"></i> Effacer
                </button>
              </div>
            </div>

            <table class="table">
              <thead>
                <tr>
                  <th>
                    <input
                      type="checkbox"
                      id="selectAllUsers"
                      onchange="userManager.toggleSelectAll()"
                      style="
                        width: 18px;
                        height: 18px;
                        cursor: pointer;
                        accent-color: var(--primary-color);
                      "
                    />
                  </th>
                  <th>ID</th>
                  <th>Nom</th>
                  <th>Email</th>
                  <th>Cours</th>
                  <th>Montant Payé</th>
                  <th>Méthode Paiement</th>
                  <th>Date Inscription</th>
                  <th>Statut</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
                <!-- Dynamic user data will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Settings Section -->
        <div id="settings-section" style="display: none">
          <!-- System Settings -->
          <div class="card">
            <div
              style="
                padding: var(--spacing-lg);
                border-bottom: 1px solid var(--border-color);
              "
            >
              <h2 class="card-title">Paramètres Système</h2>
              <p
                style="
                  color: var(--text-secondary);
                  margin-top: var(--spacing-sm);
                "
              >
                Configurez les paramètres de votre panel d'administration
              </p>
            </div>

            <div style="padding: var(--spacing-lg)">
              <div style="display: grid; gap: var(--spacing-lg)">
                <!-- Theme Settings -->
                <div class="settings-group">
                  <h3
                    style="
                      color: var(--text-primary);
                      margin-bottom: var(--spacing-md);
                      display: flex;
                      align-items: center;
                    "
                  >
                    <i
                      class="fas fa-palette"
                      style="
                        margin-right: var(--spacing-sm);
                        color: var(--primary-color);
                      "
                    ></i>
                    Apparence
                  </h3>
                  <div style="display: grid; gap: var(--spacing-md)">
                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Mode Sombre</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Interface avec thème sombre activé
                        </p>
                      </div>
                      <label class="switch">
                        <input
                          type="checkbox"
                          id="darkModeToggle"
                          checked
                          onchange="userManager.toggleDarkMode()"
                        />
                        <span class="slider"></span>
                      </label>
                    </div>

                    <!-- Advanced UI Customization -->
                    <div
                      style="
                        display: grid;
                        gap: var(--spacing-md);
                        margin-top: var(--spacing-md);
                        padding-top: var(--spacing-md);
                        border-top: 1px solid var(--border-color);
                      "
                    >
                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          align-items: center;
                        "
                      >
                        <div>
                          <label
                            style="color: var(--text-primary); font-weight: 500"
                            >Animations Fluides</label
                          >
                          <p
                            style="
                              color: var(--text-secondary);
                              font-size: 0.9rem;
                              margin: 4px 0 0 0;
                            "
                          >
                            Activer les transitions et animations avancées
                          </p>
                        </div>
                        <label class="switch">
                          <input
                            type="checkbox"
                            id="smoothAnimations"
                            checked
                            onchange="userManager.toggleSmoothAnimations(this.checked)"
                          />
                          <span class="slider"></span>
                        </label>
                      </div>

                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          align-items: center;
                        "
                      >
                        <div>
                          <label
                            style="color: var(--text-primary); font-weight: 500"
                            >Mode Compact</label
                          >
                          <p
                            style="
                              color: var(--text-secondary);
                              font-size: 0.9rem;
                              margin: 4px 0 0 0;
                            "
                          >
                            Interface condensée pour plus de données visibles
                          </p>
                        </div>
                        <label class="switch">
                          <input
                            type="checkbox"
                            id="compactMode"
                            onchange="userManager.toggleCompactMode(this.checked)"
                          />
                          <span class="slider"></span>
                        </label>
                      </div>

                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          align-items: center;
                        "
                      >
                        <div>
                          <label
                            style="color: var(--text-primary); font-weight: 500"
                            >Couleur d'Accent</label
                          >
                          <p
                            style="
                              color: var(--text-secondary);
                              font-size: 0.9rem;
                              margin: 4px 0 0 0;
                            "
                          >
                            Personnaliser la couleur principale de l'interface
                          </p>
                        </div>
                        <div
                          style="display: flex; gap: 8px; align-items: center"
                        >
                          <input
                            type="color"
                            id="accentColorPicker"
                            value="#3b82f6"
                            onchange="userManager.changeAccentColor(this.value)"
                            style="
                              width: 40px;
                              height: 30px;
                              border: none;
                              border-radius: 6px;
                              cursor: pointer;
                            "
                          />
                          <button
                            onclick="userManager.resetAccentColor()"
                            class="btn btn-secondary"
                            style="padding: 4px 8px; font-size: 0.8rem"
                          >
                            Reset
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Security & Access Control -->
                <div class="settings-group">
                  <h3
                    style="
                      color: var(--text-primary);
                      margin-bottom: var(--spacing-md);
                      display: flex;
                      align-items: center;
                    "
                  >
                    <i
                      class="fas fa-shield-alt"
                      style="
                        margin-right: var(--spacing-sm);
                        color: var(--primary-color);
                      "
                    ></i>
                    Sécurité & Accès
                  </h3>
                  <div style="display: grid; gap: var(--spacing-md)">
                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Session Auto-Logout</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Déconnexion automatique après inactivité
                        </p>
                      </div>
                      <select
                        id="sessionTimeout"
                        onchange="userManager.updateSessionTimeout(this.value)"
                        style="
                          padding: 8px 12px;
                          border: 1px solid var(--border-color);
                          border-radius: var(--radius-sm);
                          background: var(--surface-color);
                          color: var(--text-primary);
                        "
                      >
                        <option value="0">Désactivé</option>
                        <option value="15">15 minutes</option>
                        <option value="30" selected>30 minutes</option>
                        <option value="60">1 heure</option>
                        <option value="120">2 heures</option>
                      </select>
                    </div>

                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Authentification à 2 Facteurs</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Sécurité renforcée avec code secondaire
                        </p>
                      </div>
                      <label class="switch">
                        <input
                          type="checkbox"
                          id="twoFactorAuth"
                          onchange="userManager.toggle2FA(this.checked)"
                        />
                        <span class="slider"></span>
                      </label>
                    </div>

                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Journal d'Activité Avancé</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Enregistrer toutes les actions sensibles
                        </p>
                      </div>
                      <label class="switch">
                        <input
                          type="checkbox"
                          id="advancedLogging"
                          checked
                          onchange="userManager.toggleAdvancedLogging(this.checked)"
                        />
                        <span class="slider"></span>
                      </label>
                    </div>

                    <div
                      style="
                        border-top: 1px solid var(--border-color);
                        padding-top: var(--spacing-md);
                        margin-top: var(--spacing-md);
                      "
                    >
                      <button
                        onclick="userManager.changeAdminPassword()"
                        class="btn btn-warning"
                        style="margin-right: var(--spacing-sm)"
                      >
                        <i class="fas fa-key"></i> Changer Code Admin
                      </button>
                      <button
                        onclick="userManager.viewSecurityLog()"
                        class="btn btn-info"
                      >
                        <i class="fas fa-file-shield"></i> Journal Sécurité
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Performance & Monitoring -->
                <div class="settings-group">
                  <h3
                    style="
                      color: var(--text-primary);
                      margin-bottom: var(--spacing-md);
                      display: flex;
                      align-items: center;
                    "
                  >
                    <i
                      class="fas fa-tachometer-alt"
                      style="
                        margin-right: var(--spacing-sm);
                        color: var(--primary-color);
                      "
                    ></i>
                    Performance & Monitoring
                  </h3>
                  <div style="display: grid; gap: var(--spacing-md)">
                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Monitoring Temps Réel</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Surveiller les performances système en continu
                        </p>
                      </div>
                      <label class="switch">
                        <input
                          type="checkbox"
                          id="realTimeMonitoring"
                          checked
                          onchange="userManager.toggleRealTimeMonitoring(this.checked)"
                        />
                        <span class="slider"></span>
                      </label>
                    </div>

                    <div
                      style="
                        display: grid;
                        grid-template-columns: repeat(
                          auto-fit,
                          minmax(150px, 1fr)
                        );
                        gap: var(--spacing-md);
                        background: rgba(255, 255, 255, 0.02);
                        padding: var(--spacing-md);
                        border-radius: var(--radius-md);
                        border: 1px solid var(--border-color);
                      "
                    >
                      <div style="text-align: center">
                        <div
                          style="
                            color: var(--success-color);
                            font-size: 1.5rem;
                            font-weight: bold;
                          "
                          id="systemCPU"
                        >
                          --
                        </div>
                        <div
                          style="
                            color: var(--text-secondary);
                            font-size: 0.8rem;
                          "
                        >
                          CPU Usage
                        </div>
                      </div>
                      <div style="text-align: center">
                        <div
                          style="
                            color: var(--info-color);
                            font-size: 1.5rem;
                            font-weight: bold;
                          "
                          id="systemRAM"
                        >
                          --
                        </div>
                        <div
                          style="
                            color: var(--text-secondary);
                            font-size: 0.8rem;
                          "
                        >
                          Memory
                        </div>
                      </div>
                      <div style="text-align: center">
                        <div
                          style="
                            color: var(--warning-color);
                            font-size: 1.5rem;
                            font-weight: bold;
                          "
                          id="systemLatency"
                        >
                          --
                        </div>
                        <div
                          style="
                            color: var(--text-secondary);
                            font-size: 0.8rem;
                          "
                        >
                          Latency
                        </div>
                      </div>
                      <div style="text-align: center">
                        <div
                          style="
                            color: var(--primary-color);
                            font-size: 1.5rem;
                            font-weight: bold;
                          "
                          id="systemUptime"
                        >
                          --
                        </div>
                        <div
                          style="
                            color: var(--text-secondary);
                            font-size: 0.8rem;
                          "
                        >
                          Uptime
                        </div>
                      </div>
                    </div>

                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Cache Intelligent</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Optimiser les performances avec mise en cache
                        </p>
                      </div>
                      <label class="switch">
                        <input
                          type="checkbox"
                          id="smartCaching"
                          checked
                          onchange="userManager.toggleSmartCaching(this.checked)"
                        />
                        <span class="slider"></span>
                      </label>
                    </div>

                    <!-- Advanced UI Customization -->
                    <div
                      style="
                        display: grid;
                        gap: var(--spacing-md);
                        margin-top: var(--spacing-md);
                        padding-top: var(--spacing-md);
                        border-top: 1px solid var(--border-color);
                      "
                    >
                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          align-items: center;
                        "
                      >
                        <div>
                          <label
                            style="color: var(--text-primary); font-weight: 500"
                            >Animations Fluides</label
                          >
                          <p
                            style="
                              color: var(--text-secondary);
                              font-size: 0.9rem;
                              margin: 4px 0 0 0;
                            "
                          >
                            Activer les transitions et animations avancées
                          </p>
                        </div>
                        <label class="switch">
                          <input
                            type="checkbox"
                            id="smoothAnimations"
                            checked
                            onchange="userManager.toggleSmoothAnimations(this.checked)"
                          />
                          <span class="slider"></span>
                        </label>
                      </div>

                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          align-items: center;
                        "
                      >
                        <div>
                          <label
                            style="color: var(--text-primary); font-weight: 500"
                            >Mode Compact</label
                          >
                          <p
                            style="
                              color: var(--text-secondary);
                              font-size: 0.9rem;
                              margin: 4px 0 0 0;
                            "
                          >
                            Interface condensée pour plus de données visibles
                          </p>
                        </div>
                        <label class="switch">
                          <input
                            type="checkbox"
                            id="compactMode"
                            onchange="userManager.toggleCompactMode(this.checked)"
                          />
                          <span class="slider"></span>
                        </label>
                      </div>

                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          align-items: center;
                        "
                      >
                        <div>
                          <label
                            style="color: var(--text-primary); font-weight: 500"
                            >Couleur d'Accent</label
                          >
                          <p
                            style="
                              color: var(--text-secondary);
                              font-size: 0.9rem;
                              margin: 4px 0 0 0;
                            "
                          >
                            Personnaliser la couleur principale de l'interface
                          </p>
                        </div>
                        <div
                          style="display: flex; gap: 8px; align-items: center"
                        >
                          <input
                            type="color"
                            id="accentColorPicker"
                            value="#3b82f6"
                            onchange="userManager.changeAccentColor(this.value)"
                            style="
                              width: 40px;
                              height: 30px;
                              border: none;
                              border-radius: 6px;
                              cursor: pointer;
                            "
                          />
                          <button
                            onclick="userManager.resetAccentColor()"
                            class="btn btn-secondary"
                            style="padding: 4px 8px; font-size: 0.8rem"
                          >
                            Reset
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Security & Access Control -->
                <div class="settings-group">
                  <h3
                    style="
                      color: var(--text-primary);
                      margin-bottom: var(--spacing-md);
                      display: flex;
                      align-items: center;
                    "
                  >
                    <i
                      class="fas fa-shield-alt"
                      style="
                        margin-right: var(--spacing-sm);
                        color: var(--primary-color);
                      "
                    ></i>
                    Sécurité & Accès
                  </h3>
                  <div style="display: grid; gap: var(--spacing-md)">
                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Session Auto-Logout</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Déconnexion automatique après inactivité
                        </p>
                      </div>
                      <select
                        id="sessionTimeout"
                        onchange="userManager.updateSessionTimeout(this.value)"
                        style="
                          padding: 8px 12px;
                          border: 1px solid var(--border-color);
                          border-radius: var(--radius-sm);
                          background: var(--surface-color);
                          color: var(--text-primary);
                        "
                      >
                        <option value="0">Désactivé</option>
                        <option value="15">15 minutes</option>
                        <option value="30" selected>30 minutes</option>
                        <option value="60">1 heure</option>
                        <option value="120">2 heures</option>
                      </select>
                    </div>

                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Authentification à 2 Facteurs</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Sécurité renforcée avec code secondaire
                        </p>
                      </div>
                      <label class="switch">
                        <input
                          type="checkbox"
                          id="twoFactorAuth"
                          onchange="userManager.toggle2FA(this.checked)"
                        />
                        <span class="slider"></span>
                      </label>
                    </div>

                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Journal d'Activité Avancé</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Enregistrer toutes les actions sensibles
                        </p>
                      </div>
                      <label class="switch">
                        <input
                          type="checkbox"
                          id="advancedLogging"
                          checked
                          onchange="userManager.toggleAdvancedLogging(this.checked)"
                        />
                        <span class="slider"></span>
                      </label>
                    </div>

                    <div
                      style="
                        border-top: 1px solid var(--border-color);
                        padding-top: var(--spacing-md);
                        margin-top: var(--spacing-md);
                      "
                    >
                      <button
                        onclick="userManager.changeAdminPassword()"
                        class="btn btn-warning"
                        style="margin-right: var(--spacing-sm)"
                      >
                        <i class="fas fa-key"></i> Changer Code Admin
                      </button>
                      <button
                        onclick="userManager.viewSecurityLog()"
                        class="btn btn-info"
                      >
                        <i class="fas fa-file-shield"></i> Journal Sécurité
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Performance & Monitoring -->
                <div class="settings-group">
                  <h3
                    style="
                      color: var(--text-primary);
                      margin-bottom: var(--spacing-md);
                      display: flex;
                      align-items: center;
                    "
                  >
                    <i
                      class="fas fa-tachometer-alt"
                      style="
                        margin-right: var(--spacing-sm);
                        color: var(--primary-color);
                      "
                    ></i>
                    Performance & Monitoring
                  </h3>
                  <div style="display: grid; gap: var(--spacing-md)">
                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Monitoring Temps Réel</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Surveiller les performances système en continu
                        </p>
                      </div>
                      <label class="switch">
                        <input
                          type="checkbox"
                          id="realTimeMonitoring"
                          checked
                          onchange="userManager.toggleRealTimeMonitoring(this.checked)"
                        />
                        <span class="slider"></span>
                      </label>
                    </div>

                    <div
                      style="
                        display: grid;
                        grid-template-columns: repeat(
                          auto-fit,
                          minmax(150px, 1fr)
                        );
                        gap: var(--spacing-md);
                        background: rgba(255, 255, 255, 0.02);
                        padding: var(--spacing-md);
                        border-radius: var(--radius-md);
                        border: 1px solid var(--border-color);
                      "
                    >
                      <div style="text-align: center">
                        <div
                          style="
                            color: var(--success-color);
                            font-size: 1.5rem;
                            font-weight: bold;
                          "
                          id="systemCPU"
                        >
                          --
                        </div>
                        <div
                          style="
                            color: var(--text-secondary);
                            font-size: 0.8rem;
                          "
                        >
                          CPU Usage
                        </div>
                      </div>
                      <div style="text-align: center">
                        <div
                          style="
                            color: var(--info-color);
                            font-size: 1.5rem;
                            font-weight: bold;
                          "
                          id="systemRAM"
                        >
                          --
                        </div>
                        <div
                          style="
                            color: var(--text-secondary);
                            font-size: 0.8rem;
                          "
                        >
                          Memory
                        </div>
                      </div>
                      <div style="text-align: center">
                        <div
                          style="
                            color: var(--warning-color);
                            font-size: 1.5rem;
                            font-weight: bold;
                          "
                          id="systemLatency"
                        >
                          --
                        </div>
                        <div
                          style="
                            color: var(--text-secondary);
                            font-size: 0.8rem;
                          "
                        >
                          Latency
                        </div>
                      </div>
                      <div style="text-align: center">
                        <div
                          style="
                            color: var(--primary-color);
                            font-size: 1.5rem;
                            font-weight: bold;
                          "
                          id="systemUptime"
                        >
                          --
                        </div>
                        <div
                          style="
                            color: var(--text-secondary);
                            font-size: 0.8rem;
                          "
                        >
                          Uptime
                        </div>
                      </div>
                    </div>

                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Cache Intelligent</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Optimiser les performances avec mise en cache
                        </p>
                      </div>
                      <label class="switch">
                        <input
                          type="checkbox"
                          id="smartCaching"
                          checked
                          onchange="userManager.toggleSmartCaching(this.checked)"
                        />
                        <span class="slider"></span>
                      </label>
                    </div>
                  </div>
                </div>

                <!-- Notification Settings -->
                <div class="settings-group">
                  <h3
                    style="
                      color: var(--text-primary);
                      margin-bottom: var(--spacing-md);
                      display: flex;
                      align-items: center;
                    "
                  >
                    <i
                      class="fas fa-bell"
                      style="
                        margin-right: var(--spacing-sm);
                        color: var(--primary-color);
                      "
                    ></i>
                    Notifications
                  </h3>
                  <div style="display: grid; gap: var(--spacing-md)">
                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Notifications de Nouvelles Inscriptions</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Recevoir des alertes pour les nouveaux utilisateurs
                        </p>
                      </div>
                      <label class="switch">
                        <input
                          type="checkbox"
                          id="newUserNotifications"
                          checked
                          onchange="userManager.updateNotificationSettings('newUsers', this.checked)"
                        />
                        <span class="slider"></span>
                      </label>
                    </div>

                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Notifications Système</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Recevoir des alertes pour les actions système
                        </p>
                      </div>
                      <label class="switch">
                        <input
                          type="checkbox"
                          id="systemNotifications"
                          checked
                          onchange="userManager.updateNotificationSettings('system', this.checked)"
                        />
                        <span class="slider"></span>
                      </label>
                    </div>

                    <!-- Advanced Notification Options -->
                    <div
                      style="
                        border-top: 1px solid var(--border-color);
                        padding-top: var(--spacing-md);
                        margin-top: var(--spacing-md);
                      "
                    >
                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          align-items: center;
                          margin-bottom: var(--spacing-md);
                        "
                      >
                        <div>
                          <label
                            style="color: var(--text-primary); font-weight: 500"
                            >Notifications Push (Email)</label
                          >
                          <p
                            style="
                              color: var(--text-secondary);
                              font-size: 0.9rem;
                              margin: 4px 0 0 0;
                            "
                          >
                            Recevoir les alertes par email
                          </p>
                        </div>
                        <label class="switch">
                          <input
                            type="checkbox"
                            id="emailNotifications"
                            onchange="userManager.toggleEmailNotifications(this.checked)"
                          />
                          <span class="slider"></span>
                        </label>
                      </div>

                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          align-items: center;
                          margin-bottom: var(--spacing-md);
                        "
                      >
                        <div>
                          <label
                            style="color: var(--text-primary); font-weight: 500"
                            >Notifications Son</label
                          >
                          <p
                            style="
                              color: var(--text-secondary);
                              font-size: 0.9rem;
                              margin: 4px 0 0 0;
                            "
                          >
                            Sons d'alerte pour les actions importantes
                          </p>
                        </div>
                        <label class="switch">
                          <input
                            type="checkbox"
                            id="soundNotifications"
                            checked
                            onchange="userManager.toggleSoundNotifications(this.checked)"
                          />
                          <span class="slider"></span>
                        </label>
                      </div>

                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          align-items: center;
                        "
                      >
                        <div>
                          <label
                            style="color: var(--text-primary); font-weight: 500"
                            >Seuil d'Alerte Revenus</label
                          >
                          <p
                            style="
                              color: var(--text-secondary);
                              font-size: 0.9rem;
                              margin: 4px 0 0 0;
                            "
                          >
                            Alerte quand les revenus dépassent un montant
                          </p>
                        </div>
                        <input
                          type="number"
                          id="revenueThreshold"
                          placeholder="10000"
                          min="0"
                          step="1000"
                          onchange="userManager.setRevenueThreshold(this.value)"
                          style="
                            width: 120px;
                            padding: 8px 12px;
                            border: 1px solid var(--border-color);
                            border-radius: var(--radius-sm);
                            background: var(--surface-color);
                            color: var(--text-primary);
                          "
                        />
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Automation & Rules -->
                <div class="settings-group">
                  <h3
                    style="
                      color: var(--text-primary);
                      margin-bottom: var(--spacing-md);
                      display: flex;
                      align-items: center;
                    "
                  >
                    <i
                      class="fas fa-robot"
                      style="
                        margin-right: var(--spacing-sm);
                        color: var(--primary-color);
                      "
                    ></i>
                    Automatisation & Règles
                  </h3>
                  <div style="display: grid; gap: var(--spacing-md)">
                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Auto-Archivage</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Archiver automatiquement les anciens utilisateurs
                        </p>
                      </div>
                      <select
                        id="autoArchive"
                        onchange="userManager.setAutoArchive(this.value)"
                        style="
                          padding: 8px 12px;
                          border: 1px solid var(--border-color);
                          border-radius: var(--radius-sm);
                          background: var(--surface-color);
                          color: var(--text-primary);
                        "
                      >
                        <option value="0">Désactivé</option>
                        <option value="30">30 jours</option>
                        <option value="90" selected>90 jours</option>
                        <option value="365">1 an</option>
                      </select>
                    </div>

                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Sauvegarde Automatique</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Créer des sauvegardes automatiques régulières
                        </p>
                      </div>
                      <select
                        id="autoBackup"
                        onchange="userManager.setAutoBackup(this.value)"
                        style="
                          padding: 8px 12px;
                          border: 1px solid var(--border-color);
                          border-radius: var(--radius-sm);
                          background: var(--surface-color);
                          color: var(--text-primary);
                        "
                      >
                        <option value="0">Désactivé</option>
                        <option value="daily">Quotidienne</option>
                        <option value="weekly" selected>Hebdomadaire</option>
                        <option value="monthly">Mensuelle</option>
                      </select>
                    </div>

                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Nettoyage Intelligent</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Nettoyer automatiquement les données temporaires
                        </p>
                      </div>
                      <label class="switch">
                        <input
                          type="checkbox"
                          id="smartCleanup"
                          checked
                          onchange="userManager.toggleSmartCleanup(this.checked)"
                        />
                        <span class="slider"></span>
                      </label>
                    </div>

                    <div
                      style="
                        border-top: 1px solid var(--border-color);
                        padding-top: var(--spacing-md);
                        margin-top: var(--spacing-md);
                      "
                    >
                      <button
                        onclick="userManager.createCustomRule()"
                        class="btn btn-primary"
                        style="margin-right: var(--spacing-sm)"
                      >
                        <i class="fas fa-plus"></i> Créer Règle Personnalisée
                      </button>
                      <button
                        onclick="userManager.viewAutomationLogs()"
                        class="btn btn-secondary"
                      >
                        <i class="fas fa-list"></i> Journal Automatisation
                      </button>
                    </div>
                  </div>
                </div>

                <!-- API & Integration -->
                <div class="settings-group">
                  <h3
                    style="
                      color: var(--text-primary);
                      margin-bottom: var(--spacing-md);
                      display: flex;
                      align-items: center;
                    "
                  >
                    <i
                      class="fas fa-plug"
                      style="
                        margin-right: var(--spacing-sm);
                        color: var(--primary-color);
                      "
                    ></i>
                    API & Intégrations
                  </h3>
                  <div style="display: grid; gap: var(--spacing-md)">
                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >API REST Activée</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Permettre l'accès externe via API REST
                        </p>
                      </div>
                      <label class="switch">
                        <input
                          type="checkbox"
                          id="apiEnabled"
                          onchange="userManager.toggleAPI(this.checked)"
                        />
                        <span class="slider"></span>
                      </label>
                    </div>

                    <div
                      style="
                        background: rgba(255, 255, 255, 0.02);
                        padding: var(--spacing-md);
                        border-radius: var(--radius-md);
                        border: 1px solid var(--border-color);
                      "
                    >
                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          align-items: center;
                          margin-bottom: var(--spacing-sm);
                        "
                      >
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Clé API</label
                        >
                        <button
                          onclick="userManager.generateAPIKey()"
                          class="btn btn-secondary"
                          style="padding: 4px 8px; font-size: 0.8rem"
                        >
                          <i class="fas fa-sync"></i> Générer
                        </button>
                      </div>
                      <input
                        type="text"
                        id="apiKey"
                        readonly
                        placeholder="Générer une clé API..."
                        style="
                          width: 100%;
                          padding: 8px 12px;
                          border: 1px solid var(--border-color);
                          border-radius: var(--radius-sm);
                          background: var(--surface-color);
                          color: var(--text-primary);
                          font-family: monospace;
                          font-size: 0.9rem;
                        "
                      />
                    </div>

                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Webhooks</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Notifications automatiques vers services externes
                        </p>
                      </div>
                      <button
                        onclick="userManager.configureWebhooks()"
                        class="btn btn-info"
                        style="padding: 8px 12px; font-size: 0.9rem"
                      >
                        <i class="fas fa-cog"></i> Configurer
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Data Management -->
                <div class="settings-group">
                  <h3
                    style="
                      color: var(--text-primary);
                      margin-bottom: var(--spacing-md);
                      display: flex;
                      align-items: center;
                    "
                  >
                    <i
                      class="fas fa-database"
                      style="
                        margin-right: var(--spacing-sm);
                        color: var(--primary-color);
                      "
                    ></i>
                    Gestion des Données
                  </h3>
                  <div style="display: grid; gap: var(--spacing-md)">
                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    >
                      <div>
                        <label
                          style="color: var(--text-primary); font-weight: 500"
                          >Auto-actualisation</label
                        >
                        <p
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                            margin: 4px 0 0 0;
                          "
                        >
                          Actualiser automatiquement les données toutes les 30
                          secondes
                        </p>
                      </div>
                      <label class="switch">
                        <input
                          type="checkbox"
                          id="autoRefresh"
                          checked
                          onchange="userManager.toggleAutoRefresh(this.checked)"
                        />
                        <span class="slider"></span>
                      </label>
                    </div>

                    <div
                      style="
                        border-top: 1px solid var(--border-color);
                        padding-top: var(--spacing-md);
                        margin-top: var(--spacing-md);
                      "
                    >
                      <div
                        style="
                          display: flex;
                          gap: var(--spacing-md);
                          flex-wrap: wrap;
                        "
                      >
                        <button
                          onclick="userManager.backupData()"
                          class="btn btn-info"
                        >
                          <i class="fas fa-download"></i> Sauvegarder Données
                        </button>
                        <button
                          onclick="userManager.clearAllData()"
                          class="btn btn-warning"
                        >
                          <i class="fas fa-trash-alt"></i> Effacer Toutes
                          Données
                        </button>
                        <button
                          onclick="userManager.resetSettings()"
                          class="btn btn-secondary"
                        >
                          <i class="fas fa-undo"></i> Reset Paramètres
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- System Information -->
                <div class="settings-group">
                  <h3
                    style="
                      color: var(--text-primary);
                      margin-bottom: var(--spacing-md);
                      display: flex;
                      align-items: center;
                    "
                  >
                    <i
                      class="fas fa-info-circle"
                      style="
                        margin-right: var(--spacing-sm);
                        color: var(--primary-color);
                      "
                    ></i>
                    Informations Système
                  </h3>
                  <div
                    style="
                      background: rgba(255, 255, 255, 0.02);
                      padding: var(--spacing-md);
                      border-radius: var(--radius-md);
                      border: 1px solid var(--border-color);
                    "
                  >
                    <div
                      style="
                        display: grid;
                        grid-template-columns: repeat(
                          auto-fit,
                          minmax(200px, 1fr)
                        );
                        gap: var(--spacing-md);
                      "
                    >
                      <div>
                        <label
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                          "
                          >Version Admin Panel</label
                        >
                        <p style="color: var(--text-primary); font-weight: 500">
                          v2.1.0
                        </p>
                      </div>
                      <div>
                        <label
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                          "
                          >Dernière Connexion</label
                        >
                        <p
                          style="color: var(--text-primary); font-weight: 500"
                          id="lastLoginTime"
                        >
                          -
                        </p>
                      </div>
                      <div>
                        <label
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                          "
                          >Utilisateurs Stockés</label
                        >
                        <p
                          style="color: var(--text-primary); font-weight: 500"
                          id="totalStoredUsers"
                        >
                          0
                        </p>
                      </div>
                      <div>
                        <label
                          style="
                            color: var(--text-secondary);
                            font-size: 0.9rem;
                          "
                          >Taille Stockage</label
                        >
                        <p
                          style="color: var(--text-primary); font-weight: 500"
                          id="storageSize"
                        >
                          0 KB
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      // Authentication System
      const ADMIN_CODE = "admin123";

      // Authentication functions
      function showCodeInput() {
        document.getElementById("authStep1").style.display = "none";
        document.getElementById("codeInputContainer").classList.add("show");

        // Focus on input field
        setTimeout(() => {
          document.getElementById("adminCode").focus();
        }, 300);
      }

      function showMainAuth() {
        document.getElementById("codeInputContainer").classList.remove("show");
        document.getElementById("authStep1").style.display = "block";

        // Clear input and error
        document.getElementById("adminCode").value = "";
        document.getElementById("errorMessage").classList.remove("show");
      }

      function redirectToHome() {
        // Show loading animation
        const loadingDiv = document.createElement("div");
        loadingDiv.innerHTML = `
          <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                      background: rgba(0,0,0,0.8); z-index: 20000; 
                      display: flex; align-items: center; justify-content: center;">
            <div style="text-align: center; color: white;">
              <div style="width: 50px; height: 50px; border: 4px solid rgba(255,255,255,0.3); 
                          border-top: 4px solid white; border-radius: 50%; 
                          animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
              <p>Redirection vers la page d'accueil...</p>
            </div>
          </div>
        `;
        document.body.appendChild(loadingDiv);

        // Redirect after short delay
        setTimeout(() => {
          window.location.href = "index.html";
        }, 1500);
      }

      function verifyCode() {
        const codeInput = document.getElementById("adminCode");
        const errorMessage = document.getElementById("errorMessage");
        const loadingSpinner = document.getElementById("loadingSpinner");
        const submitButton = document.querySelector(".auth-submit");

        const enteredCode = codeInput.value.trim();

        if (!enteredCode) {
          showError("Veuillez entrer le code d'accès.");
          return;
        }

        // Show loading
        loadingSpinner.classList.add("show");
        submitButton.disabled = true;
        errorMessage.classList.remove("show");

        // Simulate verification delay for better UX
        setTimeout(() => {
          if (enteredCode === ADMIN_CODE) {
            // Success - hide auth overlay
            const authOverlay = document.getElementById("authOverlay");
            authOverlay.classList.add("hidden");

            // Show success message briefly
            const successMessage = document.createElement("div");
            successMessage.innerHTML = `
              <div style="position: fixed; top: 20px; right: 20px; z-index: 15000;
                          background: linear-gradient(135deg, #10b981, #059669);
                          color: white; padding: 1rem 1.5rem; border-radius: 12px;
                          box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
                          animation: slideInRight 0.5s ease;">
                <i class="fas fa-check-circle"></i> Accès autorisé - Bienvenue !
              </div>
            `;
            document.body.appendChild(successMessage);

            // Remove success message after 3 seconds
            setTimeout(() => {
              successMessage.remove();
            }, 3000);

            // Initialize the admin system
            setTimeout(() => {
              window.userManager = new UserManager();
              // Log admin login
              window.userManager.logActivity("Admin connecté", {
                timestamp: new Date().toISOString(),
                sessionId: Date.now().toString(),
              });
            }, 100);
          } else {
            // Error - wrong code
            showError("Code incorrect. Veuillez réessayer.");
            codeInput.value = "";
            codeInput.focus();
          }

          // Hide loading
          loadingSpinner.classList.remove("show");
          submitButton.disabled = false;
        }, 1200);
      }

      function showError(message) {
        const errorMessage = document.getElementById("errorMessage");
        errorMessage.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
        errorMessage.classList.add("show");
      }

      // Add Enter key support for code input
      document.addEventListener("DOMContentLoaded", function () {
        const codeInput = document.getElementById("adminCode");
        if (codeInput) {
          codeInput.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              verifyCode();
            }
          });
        }

        // Add slide-in animation for success messages
        const style = document.createElement("style");
        style.textContent = `
          @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
        `;
        document.head.appendChild(style);
      });

      // User Management System
      class UserManager {
        constructor() {
          this.users = this.loadUsers();
          this.filteredUsers = [...this.users]; // Initialize filtered users
          this.activityLog = this.loadActivityLog(); // Initialize activity log
          this.settings = this.loadSettings(); // Initialize settings
          this.charts = {}; // Store chart instances
          this.customRules = []; // Store custom automation rules
          this.initializeEventListeners();
          this.refreshDashboard();
          this.refreshActivityFeed();
          this.initializeCharts();
          this.initializeAdvancedFeatures();
        }

        // Load users from localStorage
        loadUsers() {
          const storedUsers = localStorage.getItem("mdai_users");
          return storedUsers ? JSON.parse(storedUsers) : [];
        }

        // Load activity log from localStorage
        loadActivityLog() {
          const storedLog = localStorage.getItem("mdai_activity_log");
          return storedLog ? JSON.parse(storedLog) : [];
        }

        // Save activity log to localStorage
        saveActivityLog() {
          localStorage.setItem(
            "mdai_activity_log",
            JSON.stringify(this.activityLog)
          );
        }

        // Add activity to log
        logActivity(action, details = {}) {
          const activity = {
            id: Date.now().toString(),
            timestamp: new Date().toISOString(),
            action: action,
            details: details,
            userAgent: navigator.userAgent.split(" ")[0], // Simple browser detection
          };

          this.activityLog.unshift(activity); // Add to beginning

          // Keep only last 100 activities
          if (this.activityLog.length > 100) {
            this.activityLog = this.activityLog.slice(0, 100);
          }

          this.saveActivityLog();
          this.refreshActivityFeed();
        }

        // Save users to localStorage
        saveUsers() {
          localStorage.setItem("mdai_users", JSON.stringify(this.users));
        }

        // Add new user (called from payment form)
        addUser(userData) {
          const newUser = {
            id: this.generateUserId(),
            name: userData.to_name,
            email: userData.email,
            course: userData.course_title || "Cours Non Spécifié",
            amount: parseFloat(userData.total_amount) || 0,
            paymentMethod: userData.payment_method || "Non Spécifié",
            registrationDate: new Date().toISOString(),
            status: "Actif",
            transactionId:
              userData.transaction_id || this.generateTransactionId(),
            receiptNumber:
              userData.receipt_number || this.generateReceiptNumber(),
            courseInfo: userData.course_info || "",
            paymentDate:
              userData.payment_date || new Date().toISOString().split("T")[0],
            paymentTime:
              userData.payment_time || new Date().toLocaleTimeString(),
          };

          this.users.push(newUser);
          this.saveUsers();
          this.refreshDashboard();
          this.showNotification(
            `Nouvel utilisateur ajouté: ${newUser.name}`,
            "success"
          );

          return newUser;
        }

        // Generate unique user ID
        generateUserId() {
          return (
            "USR" +
            Date.now().toString().slice(-6) +
            Math.floor(Math.random() * 100)
              .toString()
              .padStart(2, "0")
          );
        }

        // Generate transaction ID
        generateTransactionId() {
          return (
            "TXN" + Date.now().toString() + Math.floor(Math.random() * 1000)
          );
        }

        // Generate receipt number
        generateReceiptNumber() {
          return (
            "RCP" + new Date().getFullYear() + Date.now().toString().slice(-6)
          );
        }

        // Refresh dashboard statistics
        refreshDashboard() {
          // Update users section stats
          if (document.getElementById("totalUsers")) {
            document.getElementById("totalUsers").textContent =
              this.users.length;
          }

          // Today's registrations
          const today = new Date().toISOString().split("T")[0];
          const todayRegistrations = this.users.filter(
            (user) => user.registrationDate.split("T")[0] === today
          ).length;
          if (document.getElementById("todayRegistrations")) {
            document.getElementById("todayRegistrations").textContent =
              todayRegistrations;
          }

          // Total revenue
          const totalRevenue = this.users.reduce(
            (sum, user) => sum + user.amount,
            0
          );
          if (document.getElementById("totalRevenue")) {
            document.getElementById("totalRevenue").textContent =
              totalRevenue.toLocaleString() + " FC";
          }

          // Active users (assuming all registered users are active)
          const activeUsers = this.users.filter(
            (user) => user.status === "Actif"
          ).length;
          if (document.getElementById("activeUsers")) {
            document.getElementById("activeUsers").textContent = activeUsers;
          }

          // Update main dashboard stats as well
          if (document.getElementById("dashboardActiveUsers")) {
            document.getElementById("dashboardActiveUsers").textContent =
              activeUsers.toLocaleString();
          }

          if (document.getElementById("dashboardSessions")) {
            // Calculate sessions as total completed registrations
            document.getElementById("dashboardSessions").textContent =
              this.users.length.toLocaleString();
          }

          if (document.getElementById("dashboardSatisfaction")) {
            // Calculate satisfaction rate based on active users percentage
            const satisfactionRate =
              this.users.length > 0
                ? Math.round((activeUsers / this.users.length) * 100)
                : 95;
            document.getElementById("dashboardSatisfaction").textContent =
              satisfactionRate + "%";
          }

          // Update users table
          this.refreshUsersTable();

          // Update charts
          this.updateCharts();
        }

        // Filter users based on search and filters
        filterUsers() {
          const searchInput = document
            .getElementById("searchInput")
            .value.toLowerCase();
          const courseFilter = document.getElementById("courseFilter").value;
          const paymentFilter = document.getElementById("paymentFilter").value;
          const statusFilter = document.getElementById("statusFilter").value;

          this.filteredUsers = this.users.filter((user) => {
            const matchesSearch =
              !searchInput ||
              user.name.toLowerCase().includes(searchInput) ||
              user.email.toLowerCase().includes(searchInput) ||
              user.course.toLowerCase().includes(searchInput);

            const matchesCourse = !courseFilter || user.course === courseFilter;
            const matchesPayment =
              !paymentFilter || user.paymentMethod === paymentFilter;
            const matchesStatus = !statusFilter || user.status === statusFilter;

            return (
              matchesSearch && matchesCourse && matchesPayment && matchesStatus
            );
          });

          // Log filter activity if filters are applied
          if (searchInput || courseFilter || paymentFilter || statusFilter) {
            this.logActivity("Filtres appliqués", {
              search: searchInput || "N/A",
              course: courseFilter || "Tous",
              payment: paymentFilter || "Toutes",
              status: statusFilter || "Tous",
              resultsCount: this.filteredUsers.length,
            });
          }

          this.refreshUsersTable();
        }

        // Clear all filters
        clearFilters() {
          document.getElementById("searchInput").value = "";
          document.getElementById("courseFilter").value = "";
          document.getElementById("paymentFilter").value = "";
          document.getElementById("statusFilter").value = "";
          this.filteredUsers = [...this.users];
          this.refreshUsersTable();
        }

        // Toggle select all users
        toggleSelectAll() {
          const selectAllCheckbox = document.getElementById("selectAllUsers");
          const userCheckboxes = document.querySelectorAll(".user-checkbox");

          userCheckboxes.forEach((checkbox) => {
            checkbox.checked = selectAllCheckbox.checked;
          });

          this.updateSelectedUsers();
        }

        // Update selected users and show/hide bulk actions
        updateSelectedUsers() {
          const selectedCheckboxes = document.querySelectorAll(
            ".user-checkbox:checked"
          );
          const selectedCount = selectedCheckboxes.length;
          const totalCheckboxes = document.querySelectorAll(".user-checkbox");

          // Update select all checkbox state
          const selectAllCheckbox = document.getElementById("selectAllUsers");
          if (selectedCount === 0) {
            selectAllCheckbox.indeterminate = false;
            selectAllCheckbox.checked = false;
          } else if (selectedCount === totalCheckboxes.length) {
            selectAllCheckbox.indeterminate = false;
            selectAllCheckbox.checked = true;
          } else {
            selectAllCheckbox.indeterminate = true;
          }

          // Show/hide bulk actions and counter
          const bulkActions = document.getElementById("bulkActions");
          const selectedCountEl = document.getElementById("selectedCount");
          const selectedCountText =
            document.getElementById("selectedCountText");

          if (selectedCount > 0) {
            bulkActions.style.display = "flex";
            selectedCountEl.style.display = "inline-block";
            selectedCountText.textContent = selectedCount;
          } else {
            bulkActions.style.display = "none";
            selectedCountEl.style.display = "none";
          }
        }

        // Get selected user IDs
        getSelectedUserIds() {
          const selectedCheckboxes = document.querySelectorAll(
            ".user-checkbox:checked"
          );
          return Array.from(selectedCheckboxes).map((cb) => cb.dataset.userId);
        }

        // Bulk delete users
        bulkDelete() {
          const selectedIds = this.getSelectedUserIds();
          if (selectedIds.length === 0) return;

          if (
            !confirm(
              `Êtes-vous sûr de vouloir supprimer ${selectedIds.length} utilisateur(s) ?`
            )
          ) {
            return;
          }

          const deletedUsers = this.users.filter((u) =>
            selectedIds.includes(u.id)
          );
          this.users = this.users.filter((u) => !selectedIds.includes(u.id));
          this.filteredUsers = [...this.users];
          this.saveUsers();

          // Log bulk deletion
          this.logActivity("Suppression groupée", {
            count: selectedIds.length,
            userNames: deletedUsers.map((u) => u.name).join(", "),
          });

          this.refreshDashboard();
          this.showNotification(
            `${selectedIds.length} utilisateur(s) supprimé(s)`,
            "success"
          );
        }

        // Bulk update status
        bulkUpdateStatus() {
          const selectedIds = this.getSelectedUserIds();
          if (selectedIds.length === 0) return;

          const newStatus = prompt("Nouveau statut (Actif/Inactif):", "Actif");
          if (!newStatus || !["Actif", "Inactif"].includes(newStatus)) {
            this.showNotification("Statut invalide", "error");
            return;
          }

          const updatedUsers = [];
          this.users.forEach((user) => {
            if (selectedIds.includes(user.id)) {
              user.status = newStatus;
              updatedUsers.push(user.name);
            }
          });

          this.filteredUsers = [...this.users];
          this.saveUsers();

          // Log bulk status update
          this.logActivity("Mise à jour groupée du statut", {
            count: selectedIds.length,
            newStatus: newStatus,
            userNames: updatedUsers.join(", "),
          });

          this.refreshDashboard();
          this.showNotification(
            `Statut mis à jour pour ${selectedIds.length} utilisateur(s)`,
            "success"
          );
        }

        // Bulk export selected users
        bulkExport() {
          const selectedIds = this.getSelectedUserIds();
          if (selectedIds.length === 0) return;

          const selectedUsers = this.users.filter((u) =>
            selectedIds.includes(u.id)
          );
          const csvContent = this.generateCSVForUsers(selectedUsers);
          const blob = new Blob([csvContent], { type: "text/csv" });
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `utilisateurs_selection_mdai_${
            new Date().toISOString().split("T")[0]
          }.csv`;
          a.click();
          window.URL.revokeObjectURL(url);

          // Log bulk export
          this.logActivity("Export groupé", {
            count: selectedIds.length,
            filename: `utilisateurs_selection_mdai_${
              new Date().toISOString().split("T")[0]
            }.csv`,
          });

          this.showNotification(
            `${selectedIds.length} utilisateur(s) exporté(s)`,
            "success"
          );
        }

        // Generate CSV for specific users
        generateCSVForUsers(users) {
          const headers = [
            "ID",
            "Nom",
            "Email",
            "Cours",
            "Montant",
            "Méthode Paiement",
            "Date Inscription",
            "Statut",
            "Transaction ID",
          ];
          const rows = users.map((user) => [
            user.id,
            user.name,
            user.email,
            user.course,
            user.amount,
            user.paymentMethod,
            new Date(user.registrationDate).toLocaleString("fr-FR"),
            user.status,
            user.transactionId,
          ]);

          return [headers, ...rows]
            .map((row) => row.map((field) => `"${field}"`).join(","))
            .join("\n");
        }

        // Settings Management
        loadSettings() {
          const defaultSettings = {
            darkMode: true,
            notifications: {
              newUsers: true,
              system: true,
            },
            autoRefresh: true,
            lastLogin: null,
          };

          const stored = localStorage.getItem("mdai_admin_settings");
          return stored
            ? { ...defaultSettings, ...JSON.parse(stored) }
            : defaultSettings;
        }

        saveSettings() {
          localStorage.setItem(
            "mdai_admin_settings",
            JSON.stringify(this.settings)
          );
        }

        // Toggle dark mode
        toggleDarkMode() {
          this.settings.darkMode = !this.settings.darkMode;
          this.saveSettings();
          this.showNotification(
            `Mode ${this.settings.darkMode ? "sombre" : "clair"} activé`,
            "info"
          );
        }

        // Update notification settings
        updateNotificationSettings(type, enabled) {
          this.settings.notifications[type] = enabled;
          this.saveSettings();
          this.logActivity("Paramètres mis à jour", {
            setting: `Notifications ${type}`,
            value: enabled ? "Activé" : "Désactivé",
          });
          this.showNotification(
            `Notifications ${type} ${enabled ? "activées" : "désactivées"}`,
            "info"
          );
        }

        // Toggle auto refresh
        toggleAutoRefresh(enabled) {
          this.settings.autoRefresh = enabled;
          this.saveSettings();
          this.logActivity("Paramètres mis à jour", {
            setting: "Auto-actualisation",
            value: enabled ? "Activé" : "Désactivé",
          });
          this.showNotification(
            `Auto-actualisation ${enabled ? "activée" : "désactivée"}`,
            "info"
          );
        }

        // Backup all data
        backupData() {
          const backupData = {
            users: this.users,
            activityLog: this.activityLog,
            settings: this.settings,
            timestamp: new Date().toISOString(),
            version: "2.1.0",
          };

          const blob = new Blob([JSON.stringify(backupData, null, 2)], {
            type: "application/json",
          });
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `mdai_backup_${
            new Date().toISOString().split("T")[0]
          }.json`;
          a.click();
          window.URL.revokeObjectURL(url);

          this.logActivity("Sauvegarde créée", {
            users: this.users.length,
            activities: this.activityLog.length,
          });
          this.showNotification("Sauvegarde créée avec succès", "success");
        }

        // Clear all data
        clearAllData() {
          if (
            !confirm(
              "⚠️ ATTENTION: Cette action supprimera TOUTES les données (utilisateurs, activités, paramètres). Cette action est irréversible. Êtes-vous sûr ?"
            )
          ) {
            return;
          }

          if (
            !confirm(
              "Dernière confirmation: Toutes les données seront perdues définitivement. Continuer ?"
            )
          ) {
            return;
          }

          localStorage.removeItem("mdai_users");
          localStorage.removeItem("mdai_activity_log");
          localStorage.removeItem("mdai_admin_settings");

          this.users = [];
          this.filteredUsers = [];
          this.activityLog = [];
          this.settings = this.loadSettings();

          this.refresh();
          this.refreshActivityFeed();
          this.updateCharts();
          this.updateSystemInfo();

          this.showNotification(
            "Toutes les données ont été effacées",
            "warning"
          );
        }

        // Reset settings to default
        resetSettings() {
          if (
            !confirm(
              "Réinitialiser tous les paramètres aux valeurs par défaut ?"
            )
          )
            return;

          localStorage.removeItem("mdai_admin_settings");
          this.settings = this.loadSettings();

          // Update UI elements
          document.getElementById("darkModeToggle").checked =
            this.settings.darkMode;
          document.getElementById("newUserNotifications").checked =
            this.settings.notifications.newUsers;
          document.getElementById("systemNotifications").checked =
            this.settings.notifications.system;
          document.getElementById("autoRefresh").checked =
            this.settings.autoRefresh;

          this.logActivity("Paramètres réinitialisés", {
            action: "Reset des paramètres par défaut",
          });
          this.showNotification("Paramètres réinitialisés", "success");
        }

        // Update system information display
        updateSystemInfo() {
          // Last login time
          if (document.getElementById("lastLoginTime")) {
            const lastLogin = this.settings.lastLogin;
            document.getElementById("lastLoginTime").textContent = lastLogin
              ? new Date(lastLogin).toLocaleString("fr-FR")
              : "Première connexion";
          }

          // Total stored users
          if (document.getElementById("totalStoredUsers")) {
            document.getElementById("totalStoredUsers").textContent =
              this.users.length.toLocaleString();
          }

          // Storage size estimation
          if (document.getElementById("storageSize")) {
            const usersSize = JSON.stringify(this.users).length;
            const activitySize = JSON.stringify(this.activityLog).length;
            const settingsSize = JSON.stringify(this.settings).length;
            const totalSize = usersSize + activitySize + settingsSize;

            let sizeText;
            if (totalSize < 1024) {
              sizeText = totalSize + " B";
            } else if (totalSize < 1024 * 1024) {
              sizeText = Math.round(totalSize / 1024) + " KB";
            } else {
              sizeText = Math.round(totalSize / (1024 * 1024)) + " MB";
            }

            document.getElementById("storageSize").textContent = sizeText;
          }

          // Update last login
          this.settings.lastLogin = new Date().toISOString();
          this.saveSettings();
        }

        // Advanced Settings Methods

        // UI Customization
        toggleSmoothAnimations(enabled) {
          this.settings.smoothAnimations = enabled;
          this.saveSettings();
          document.documentElement.style.setProperty(
            "--transition-speed",
            enabled ? "0.3s" : "0s"
          );
          this.logActivity("Paramètres UI", {
            setting: "Animations fluides",
            value: enabled ? "Activé" : "Désactivé",
          });
          this.showNotification(
            `Animations ${enabled ? "activées" : "désactivées"}`,
            "info"
          );
        }

        toggleCompactMode(enabled) {
          this.settings.compactMode = enabled;
          this.saveSettings();
          document.body.classList.toggle("compact-mode", enabled);
          this.logActivity("Paramètres UI", {
            setting: "Mode compact",
            value: enabled ? "Activé" : "Désactivé",
          });
          this.showNotification(
            `Mode compact ${enabled ? "activé" : "désactivé"}`,
            "info"
          );
        }

        changeAccentColor(color) {
          this.settings.accentColor = color;
          this.saveSettings();
          document.documentElement.style.setProperty("--primary-color", color);
          this.logActivity("Paramètres UI", {
            setting: "Couleur d'accent",
            value: color,
          });
          this.showNotification("Couleur d'accent mise à jour", "success");
        }

        resetAccentColor() {
          const defaultColor = "#3b82f6";
          document.getElementById("accentColorPicker").value = defaultColor;
          this.changeAccentColor(defaultColor);
        }

        // Security Features
        updateSessionTimeout(minutes) {
          this.settings.sessionTimeout = parseInt(minutes);
          this.saveSettings();
          this.logActivity("Sécurité", {
            setting: "Timeout session",
            value: `${minutes} minutes`,
          });
          this.showNotification(
            `Timeout de session: ${
              minutes === "0" ? "Désactivé" : minutes + " minutes"
            }`,
            "info"
          );

          // Clear existing timeout
          if (this.sessionTimeoutId) {
            clearTimeout(this.sessionTimeoutId);
          }

          // Set new timeout if enabled
          if (minutes > 0) {
            this.sessionTimeoutId = setTimeout(() => {
              this.showNotification(
                "Session expirée - Déconnexion automatique",
                "warning"
              );
              setTimeout(() => window.location.reload(), 3000);
            }, minutes * 60 * 1000);
          }
        }

        toggle2FA(enabled) {
          this.settings.twoFactorAuth = enabled;
          this.saveSettings();
          this.logActivity("Sécurité", {
            setting: "2FA",
            value: enabled ? "Activé" : "Désactivé",
          });

          if (enabled) {
            const code = prompt(
              "Entrez un code de vérification secondaire (6 chiffres):"
            );
            if (code && code.length === 6 && /^\d+$/.test(code)) {
              this.settings.secondaryCode = code;
              this.saveSettings();
              this.showNotification(
                "Authentification à 2 facteurs activée",
                "success"
              );
            } else {
              document.getElementById("twoFactorAuth").checked = false;
              this.settings.twoFactorAuth = false;
              this.saveSettings();
              this.showNotification("Code invalide - 2FA désactivée", "error");
            }
          } else {
            this.showNotification(
              "Authentification à 2 facteurs désactivée",
              "info"
            );
          }
        }

        toggleAdvancedLogging(enabled) {
          this.settings.advancedLogging = enabled;
          this.saveSettings();
          this.logActivity("Sécurité", {
            setting: "Logging avancé",
            value: enabled ? "Activé" : "Désactivé",
          });
          this.showNotification(
            `Logging avancé ${enabled ? "activé" : "désactivé"}`,
            "info"
          );
        }

        changeAdminPassword() {
          const currentCode = prompt("Entrez le code admin actuel:");
          if (currentCode !== "admin123") {
            this.showNotification("Code admin incorrect", "error");
            return;
          }

          const newCode = prompt("Entrez le nouveau code admin:");
          if (!newCode || newCode.length < 6) {
            this.showNotification(
              "Le nouveau code doit contenir au moins 6 caractères",
              "error"
            );
            return;
          }

          const confirmCode = prompt("Confirmez le nouveau code:");
          if (newCode !== confirmCode) {
            this.showNotification("Les codes ne correspondent pas", "error");
            return;
          }

          // Note: In a real app, this would be stored securely on the server
          this.settings.adminCode = newCode;
          this.saveSettings();
          this.logActivity("Sécurité Critique", {
            action: "Code admin modifié",
          });
          this.showNotification("Code admin mis à jour avec succès", "success");
        }

        viewSecurityLog() {
          const securityEvents = this.activityLog.filter(
            (log) =>
              log.action.includes("Sécurité") ||
              log.action.includes("Admin connecté") ||
              log.action.includes("Code admin")
          );

          if (securityEvents.length === 0) {
            this.showNotification(
              "Aucun événement de sécurité enregistré",
              "info"
            );
            return;
          }

          const logText = securityEvents
            .map(
              (event) =>
                `${new Date(event.timestamp).toLocaleString("fr-FR")} - ${
                  event.action
                }: ${JSON.stringify(event.details)}`
            )
            .join("\n");

          const blob = new Blob([logText], { type: "text/plain" });
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `security_log_${
            new Date().toISOString().split("T")[0]
          }.txt`;
          a.click();
          window.URL.revokeObjectURL(url);

          this.showNotification("Journal de sécurité exporté", "success");
        }

        // Performance Monitoring
        toggleRealTimeMonitoring(enabled) {
          this.settings.realTimeMonitoring = enabled;
          this.saveSettings();

          if (enabled) {
            this.startPerformanceMonitoring();
            this.showNotification("Monitoring temps réel activé", "success");
          } else {
            this.stopPerformanceMonitoring();
            this.showNotification("Monitoring temps réel désactivé", "info");
          }
        }

        startPerformanceMonitoring() {
          // Simulate system monitoring
          this.monitoringInterval = setInterval(() => {
            // Generate fake but realistic performance data
            const cpu = Math.round(Math.random() * 30 + 10); // 10-40%
            const ram = Math.round(Math.random() * 40 + 30); // 30-70%
            const latency = Math.round(Math.random() * 50 + 10); // 10-60ms
            const uptime = Math.floor(
              (Date.now() - this.startTime) / 1000 / 60
            ); // minutes

            if (document.getElementById("systemCPU")) {
              document.getElementById("systemCPU").textContent = cpu + "%";
              document.getElementById("systemRAM").textContent = ram + "%";
              document.getElementById("systemLatency").textContent =
                latency + "ms";
              document.getElementById("systemUptime").textContent =
                uptime + "min";

              // Color coding based on values
              document.getElementById("systemCPU").style.color =
                cpu > 80
                  ? "var(--error-color)"
                  : cpu > 60
                  ? "var(--warning-color)"
                  : "var(--success-color)";
              document.getElementById("systemRAM").style.color =
                ram > 80
                  ? "var(--error-color)"
                  : ram > 60
                  ? "var(--warning-color)"
                  : "var(--info-color)";
              document.getElementById("systemLatency").style.color =
                latency > 100
                  ? "var(--error-color)"
                  : latency > 50
                  ? "var(--warning-color)"
                  : "var(--warning-color)";
            }
          }, 2000);
        }

        stopPerformanceMonitoring() {
          if (this.monitoringInterval) {
            clearInterval(this.monitoringInterval);
            this.monitoringInterval = null;
          }

          // Reset display
          ["systemCPU", "systemRAM", "systemLatency", "systemUptime"].forEach(
            (id) => {
              if (document.getElementById(id)) {
                document.getElementById(id).textContent = "--";
              }
            }
          );
        }

        toggleSmartCaching(enabled) {
          this.settings.smartCaching = enabled;
          this.saveSettings();
          this.logActivity("Performance", {
            setting: "Cache intelligent",
            value: enabled ? "Activé" : "Désactivé",
          });
          this.showNotification(
            `Cache intelligent ${enabled ? "activé" : "désactivé"}`,
            "info"
          );
        }

        // Advanced Notifications
        toggleEmailNotifications(enabled) {
          this.settings.emailNotifications = enabled;
          this.saveSettings();
          this.logActivity("Notifications", {
            setting: "Email",
            value: enabled ? "Activé" : "Désactivé",
          });
          this.showNotification(
            `Notifications email ${enabled ? "activées" : "désactivées"}`,
            "info"
          );
        }

        toggleSoundNotifications(enabled) {
          this.settings.soundNotifications = enabled;
          this.saveSettings();
          this.logActivity("Notifications", {
            setting: "Sons",
            value: enabled ? "Activé" : "Désactivé",
          });

          // Play test sound if enabled
          if (enabled) {
            this.playNotificationSound();
          }

          this.showNotification(
            `Notifications sonores ${enabled ? "activées" : "désactivées"}`,
            "info"
          );
        }

        playNotificationSound() {
          // Create a simple beep sound
          const audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          oscillator.frequency.value = 800;
          oscillator.type = "sine";

          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + 0.3
          );

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.3);
        }

        setRevenueThreshold(amount) {
          this.settings.revenueThreshold = parseInt(amount) || 0;
          this.saveSettings();
          this.logActivity("Notifications", {
            setting: "Seuil revenus",
            value: amount + " FC",
          });
          this.showNotification(`Seuil d'alerte revenus: ${amount} FC`, "info");
        }

        // Automation & Rules
        setAutoArchive(days) {
          this.settings.autoArchive = parseInt(days);
          this.saveSettings();
          this.logActivity("Automatisation", {
            setting: "Auto-archivage",
            value: days === "0" ? "Désactivé" : days + " jours",
          });
          this.showNotification(
            `Auto-archivage: ${days === "0" ? "Désactivé" : days + " jours"}`,
            "info"
          );
        }

        setAutoBackup(frequency) {
          this.settings.autoBackup = frequency;
          this.saveSettings();
          this.logActivity("Automatisation", {
            setting: "Sauvegarde auto",
            value: frequency === "0" ? "Désactivé" : frequency,
          });
          this.showNotification(
            `Sauvegarde automatique: ${
              frequency === "0" ? "Désactivée" : frequency
            }`,
            "info"
          );
        }

        toggleSmartCleanup(enabled) {
          this.settings.smartCleanup = enabled;
          this.saveSettings();
          this.logActivity("Automatisation", {
            setting: "Nettoyage intelligent",
            value: enabled ? "Activé" : "Désactivé",
          });
          this.showNotification(
            `Nettoyage intelligent ${enabled ? "activé" : "désactivé"}`,
            "info"
          );
        }

        createCustomRule() {
          const ruleName = prompt("Nom de la règle personnalisée:");
          if (!ruleName) return;

          const ruleCondition = prompt(
            "Condition (ex: nouveaux_utilisateurs > 10):"
          );
          if (!ruleCondition) return;

          const ruleAction = prompt("Action (ex: envoyer_notification):");
          if (!ruleAction) return;

          const rule = {
            id: Date.now().toString(),
            name: ruleName,
            condition: ruleCondition,
            action: ruleAction,
            created: new Date().toISOString(),
            active: true,
          };

          if (!this.customRules) this.customRules = [];
          this.customRules.push(rule);
          this.saveSettings();

          this.logActivity("Automatisation", {
            action: "Règle créée",
            rule: ruleName,
          });
          this.showNotification(
            `Règle "${ruleName}" créée avec succès`,
            "success"
          );
        }

        // Rule Execution Engine
        executeCustomRules() {
          if (!this.customRules || this.customRules.length === 0) return;

          const context = this.getRuleContext();

          this.customRules.forEach((rule) => {
            if (!rule.active) return;

            try {
              if (this.evaluateRuleCondition(rule.condition, context)) {
                this.executeRuleAction(rule.action, rule.name, context);
                this.logActivity("Règle Automatique", {
                  rule: rule.name,
                  condition: rule.condition,
                  action: rule.action,
                  triggered: true,
                });
              }
            } catch (error) {
              console.error(`Erreur dans la règle "${rule.name}":`, error);
              this.logActivity("Erreur Règle", {
                rule: rule.name,
                error: error.message,
              });
            }
          });
        }

        // Get current system context for rule evaluation
        getRuleContext() {
          const totalRevenue = this.users.reduce(
            (sum, user) => sum + (user.amount || 0),
            0
          );
          const activeUsers = this.users.filter(
            (user) => user.status === "Actif"
          ).length;
          const todayUsers = this.users.filter((user) => {
            const userDate = new Date(user.registrationDate).toDateString();
            const today = new Date().toDateString();
            return userDate === today;
          }).length;

          return {
            nouveaux_utilisateurs: todayUsers,
            utilisateurs_actifs: activeUsers,
            total_utilisateurs: this.users.length,
            revenus_totaux: totalRevenue,
            revenus_aujourd_hui: this.users
              .filter(
                (user) =>
                  new Date(user.registrationDate).toDateString() ===
                  new Date().toDateString()
              )
              .reduce((sum, user) => sum + (user.amount || 0), 0),
            heure_actuelle: new Date().getHours(),
            jour_semaine: new Date().getDay(), // 0=dimanche, 1=lundi, etc.
            activite_recente: this.activityLog.length,
          };
        }

        // Evaluate rule conditions
        evaluateRuleCondition(condition, context) {
          // Replace variables in condition with actual values
          let evalCondition = condition;

          Object.keys(context).forEach((key) => {
            const regex = new RegExp(`\\b${key}\\b`, "g");
            evalCondition = evalCondition.replace(regex, context[key]);
          });

          // Security: Only allow basic comparison operators
          const safePattern = /^[\d\s+\-*/.()<>=!&|]+$/;
          if (!safePattern.test(evalCondition)) {
            throw new Error("Condition non sécurisée détectée");
          }

          // Evaluate the condition safely
          try {
            return Function(`"use strict"; return (${evalCondition})`)();
          } catch (error) {
            throw new Error(`Condition invalide: ${condition}`);
          }
        }

        // Execute rule actions
        executeRuleAction(action, ruleName, context) {
          const actionParts = action.toLowerCase().split("_");
          const actionType = actionParts[0];

          switch (actionType) {
            case "envoyer":
              if (actionParts[1] === "notification") {
                this.showNotification(
                  `🤖 Règle "${ruleName}" déclenchée!`,
                  "info"
                );
                if (this.settings.soundNotifications) {
                  this.playNotificationSound();
                }
              } else if (actionParts[1] === "email") {
                this.sendEmailAlert(ruleName, context);
              }
              break;

            case "sauvegarder":
              if (actionParts[1] === "donnees") {
                this.backupData();
                this.showNotification(
                  `📁 Sauvegarde automatique (Règle: ${ruleName})`,
                  "success"
                );
              }
              break;

            case "nettoyer":
              if (actionParts[1] === "donnees") {
                this.performSmartCleanup();
                this.showNotification(
                  `🧹 Nettoyage automatique (Règle: ${ruleName})`,
                  "info"
                );
              }
              break;

            case "archiver":
              if (actionParts[1] === "utilisateurs") {
                this.performAutoArchive();
                this.showNotification(
                  `📦 Archivage automatique (Règle: ${ruleName})`,
                  "info"
                );
              }
              break;

            case "alerte":
              if (actionParts[1] === "admin") {
                this.showCriticalAlert(ruleName, context);
              }
              break;

            case "bloquer":
              if (actionParts[1] === "inscriptions") {
                this.temporarilyBlockRegistrations(ruleName);
              }
              break;

            default:
              console.warn(`Action non reconnue: ${action}`);
              this.showNotification(
                `⚠️ Action "${action}" non implémentée`,
                "warning"
              );
          }
        }

        // Action implementations
        sendEmailAlert(ruleName, context) {
          // Simulate email sending
          console.log(`📧 Email Alert: Règle "${ruleName}" triggered`, context);
          this.showNotification(
            `📧 Email d'alerte envoyé (${ruleName})`,
            "success"
          );
        }

        performSmartCleanup() {
          // Clean old activity logs (keep last 50)
          if (this.activityLog.length > 50) {
            this.activityLog = this.activityLog.slice(0, 50);
            this.saveActivityLog();
          }
        }

        performAutoArchive() {
          const archiveDays = this.settings.autoArchive || 90;
          const archiveDate = new Date();
          archiveDate.setDate(archiveDate.getDate() - archiveDays);

          const toArchive = this.users.filter(
            (user) =>
              new Date(user.registrationDate) < archiveDate &&
              user.status === "Inactif"
          );

          if (toArchive.length > 0) {
            // Mark as archived instead of deleting
            toArchive.forEach((user) => (user.status = "Archivé"));
            this.saveUsers();
            this.refreshDashboard();
          }
        }

        showCriticalAlert(ruleName, context) {
          const alertMsg =
            `🚨 ALERTE CRITIQUE\n\nRègle: ${ruleName}\n\nDonnées actuelles:\n` +
            `• Nouveaux utilisateurs aujourd'hui: ${context.nouveaux_utilisateurs}\n` +
            `• Utilisateurs actifs: ${context.utilisateurs_actifs}\n` +
            `• Revenus aujourd'hui: ${context.revenus_aujourd_hui} FC\n` +
            `• Revenus totaux: ${context.revenus_totaux} FC`;

          alert(alertMsg);
          this.showNotification("🚨 Alerte critique déclenchée!", "error");
        }

        temporarilyBlockRegistrations(ruleName) {
          this.settings.registrationsBlocked = true;
          this.settings.blockReason = `Règle automatique: ${ruleName}`;
          this.saveSettings();
          this.showNotification(
            "🚫 Inscriptions temporairement bloquées",
            "warning"
          );
        }

        // Initialize rule execution scheduler
        startRuleScheduler() {
          // Check rules every 30 seconds
          this.ruleScheduler = setInterval(() => {
            this.executeCustomRules();
          }, 30000);
        }

        stopRuleScheduler() {
          if (this.ruleScheduler) {
            clearInterval(this.ruleScheduler);
            this.ruleScheduler = null;
          }
        }

        viewAutomationLogs() {
          const automationEvents = this.activityLog.filter(
            (log) =>
              log.action.includes("Automatisation") ||
              log.action.includes("Sauvegarde") ||
              log.action.includes("Nettoyage")
          );

          if (automationEvents.length === 0) {
            this.showNotification("Aucun log d'automatisation", "info");
            return;
          }

          alert(
            `Logs d'automatisation (${automationEvents.length} événements):\n\n` +
              automationEvents
                .slice(0, 10)
                .map(
                  (event) =>
                    `${new Date(event.timestamp).toLocaleString("fr-FR")} - ${
                      event.action
                    }`
                )
                .join("\n")
          );
        }

        // API & Integration
        toggleAPI(enabled) {
          this.settings.apiEnabled = enabled;
          this.saveSettings();
          this.logActivity("API", {
            setting: "API REST",
            value: enabled ? "Activée" : "Désactivée",
          });
          this.showNotification(
            `API REST ${enabled ? "activée" : "désactivée"}`,
            enabled ? "success" : "warning"
          );
        }

        generateAPIKey() {
          const apiKey =
            "mdai_" +
            Array.from(crypto.getRandomValues(new Uint8Array(16)), (b) =>
              b.toString(16).padStart(2, "0")
            ).join("");

          this.settings.apiKey = apiKey;
          this.saveSettings();
          document.getElementById("apiKey").value = apiKey;

          this.logActivity("API", { action: "Nouvelle clé API générée" });
          this.showNotification("Nouvelle clé API générée", "success");
        }

        configureWebhooks() {
          const webhookUrl = prompt("URL du webhook:");
          if (!webhookUrl) return;

          const events = prompt(
            "Événements à écouter (séparés par des virgules):\nnouveau_utilisateur,paiement_recu,erreur_systeme"
          );
          if (!events) return;

          this.settings.webhooks = {
            url: webhookUrl,
            events: events.split(",").map((e) => e.trim()),
            active: true,
          };

          this.saveSettings();
          this.logActivity("API", {
            action: "Webhook configuré",
            url: webhookUrl,
          });
          this.showNotification("Webhook configuré avec succès", "success");
        }

        // Initialize advanced features
        initializeAdvancedFeatures() {
          // Set up performance monitoring start time
          this.startTime = Date.now();

          // Start real-time monitoring if enabled
          if (this.settings.realTimeMonitoring) {
            this.startPerformanceMonitoring();
          }

          // Set up session timeout if configured
          if (this.settings.sessionTimeout > 0) {
            this.updateSessionTimeout(this.settings.sessionTimeout);
          }

          // Apply UI settings
          if (this.settings.compactMode) {
            document.body.classList.add("compact-mode");
          }

          if (this.settings.accentColor) {
            document.documentElement.style.setProperty(
              "--primary-color",
              this.settings.accentColor
            );
          }

          // Update system info display
          this.updateSystemInfo();

          // Start rule scheduler
          this.startRuleScheduler();
        }

        // Refresh users table
        refreshUsersTable() {
          const tableBody = document.getElementById("usersTableBody");
          if (!tableBody) return;

          tableBody.innerHTML = "";

          // Use filtered users if filters are applied, otherwise use all users
          const usersToShow = this.filteredUsers || this.users;

          if (usersToShow.length === 0) {
            const isFiltered =
              this.filteredUsers &&
              this.filteredUsers.length !== this.users.length;
            tableBody.innerHTML = `
              <tr>
                <td colspan="10" style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                  <i class="fas fa-${
                    isFiltered ? "search" : "users"
                  }" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                  ${
                    isFiltered
                      ? "Aucun utilisateur trouvé avec ces filtres"
                      : "Aucun utilisateur enregistré pour le moment"
                  }
                </td>
              </tr>
            `;
            return;
          }

          usersToShow.forEach((user) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>
                <input type="checkbox" 
                       class="user-checkbox" 
                       data-user-id="${user.id}" 
                       onchange="userManager.updateSelectedUsers()" 
                       style="
                         width: 18px; 
                         height: 18px; 
                         cursor: pointer;
                         accent-color: var(--primary-color);
                       "/>
              </td>
              <td>${user.id}</td>
              <td>${user.name}</td>
              <td>${user.email}</td>
              <td>${user.course}</td>
              <td>${user.amount.toLocaleString()} FC</td>
              <td>
                <span style="
                  padding: 4px 8px; 
                  border-radius: 12px; 
                  font-size: 0.8rem; 
                  font-weight: 500;
                  background: ${this.getPaymentMethodColor(user.paymentMethod)};
                  color: white;
                ">
                  ${user.paymentMethod}
                </span>
              </td>
              <td>${new Date(user.registrationDate).toLocaleDateString(
                "fr-FR"
              )}</td>
              <td>
                <span style="
                  color: ${
                    user.status === "Actif"
                      ? "var(--success-color)"
                      : "var(--warning-color)"
                  }; 
                  font-weight: 500;
                ">
                  ${user.status}
                </span>
              </td>
              <td>
                <button onclick="userManager.viewUser('${user.id}')" 
                        class="btn" 
                        style="padding: 4px 8px; font-size: 0.8rem; margin-right: 4px;">
                  <i class="fas fa-eye"></i>
                </button>
                <button onclick="userManager.deleteUser('${user.id}')" 
                        class="btn" 
                        style="padding: 4px 8px; font-size: 0.8rem; background: var(--error-color); color: white;">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            `;
            tableBody.appendChild(row);
          });
        }

        // Get payment method color
        getPaymentMethodColor(method) {
          const colors = {
            PayPal: "#0070ba",
            "Google Pay": "#4285f4",
            UPI: "#ff6b35",
            "M-Pesa": "#00a86b",
            "Carte Bancaire": "#6c757d",
            Virement: "#17a2b8",
            default: "#6c757d",
          };
          return colors[method] || colors.default;
        }

        // View user details
        viewUser(userId) {
          const user = this.users.find((u) => u.id === userId);
          if (!user) return;

          alert(`Détails de l'utilisateur:
            
Nom: ${user.name}
Email: ${user.email}
Cours: ${user.course}
Montant: ${user.amount} FC
Méthode: ${user.paymentMethod}
Transaction: ${user.transactionId}
Reçu: ${user.receiptNumber}
Date: ${new Date(user.registrationDate).toLocaleString("fr-FR")}
Statut: ${user.status}`);
        }

        // Delete user
        deleteUser(userId) {
          if (!confirm("Êtes-vous sûr de vouloir supprimer cet utilisateur ?"))
            return;

          const user = this.users.find((u) => u.id === userId);
          this.users = this.users.filter((u) => u.id !== userId);
          this.filteredUsers = [...this.users];
          this.saveUsers();

          // Log the deletion activity
          this.logActivity("Utilisateur supprimé", {
            userName: user ? user.name : "Utilisateur inconnu",
            userId: userId,
            course: user ? user.course : "N/A",
          });

          this.refreshDashboard();
          this.showNotification("Utilisateur supprimé avec succès", "success");
        }

        // Export users data
        exportUsers() {
          if (this.users.length === 0) {
            this.showNotification("Aucune donnée à exporter", "warning");
            return;
          }

          const csvContent = this.generateCSV();
          const blob = new Blob([csvContent], { type: "text/csv" });
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `utilisateurs_mdai_${
            new Date().toISOString().split("T")[0]
          }.csv`;
          a.click();
          window.URL.revokeObjectURL(url);

          // Log the export activity
          this.logActivity("Données exportées", {
            userCount: this.users.length,
            filename: `utilisateurs_mdai_${
              new Date().toISOString().split("T")[0]
            }.csv`,
          });

          this.showNotification("Données exportées avec succès", "success");
        }

        // Generate CSV content
        generateCSV() {
          const headers = [
            "ID",
            "Nom",
            "Email",
            "Cours",
            "Montant",
            "Méthode Paiement",
            "Date Inscription",
            "Statut",
            "Transaction ID",
          ];
          const rows = this.users.map((user) => [
            user.id,
            user.name,
            user.email,
            user.course,
            user.amount,
            user.paymentMethod,
            new Date(user.registrationDate).toLocaleString("fr-FR"),
            user.status,
            user.transactionId,
          ]);

          return [headers, ...rows]
            .map((row) => row.map((field) => `"${field}"`).join(","))
            .join("\n");
        }

        // Refresh activity feed
        refreshActivityFeed() {
          const activityFeed = document.getElementById("activityFeed");
          if (!activityFeed) return;

          if (this.activityLog.length === 0) {
            activityFeed.innerHTML = `
              <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                <i class="fas fa-clock" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                Aucune activité récente
              </div>
            `;
            return;
          }

          activityFeed.innerHTML = this.activityLog
            .map((activity) => {
              const timeAgo = this.getTimeAgo(new Date(activity.timestamp));
              const icon = this.getActivityIcon(activity.action);
              const color = this.getActivityColor(activity.action);

              return `
              <div class="activity-item" style="
                display: flex;
                align-items: center;
                padding: var(--spacing-md);
                border-bottom: 1px solid var(--border-color);
                transition: background-color 0.2s ease;
              " onmouseover="this.style.backgroundColor='rgba(255,255,255,0.02)'" 
                 onmouseout="this.style.backgroundColor='transparent'">
                <div style="
                  width: 40px;
                  height: 40px;
                  border-radius: 50%;
                  background: ${color};
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  margin-right: var(--spacing-md);
                  flex-shrink: 0;
                ">
                  <i class="fas fa-${icon}" style="color: white; font-size: 0.9rem;"></i>
                </div>
                <div style="flex: 1;">
                  <div style="font-weight: 500; color: var(--text-primary); margin-bottom: 2px;">
                    ${activity.action}
                  </div>
                  <div style="font-size: 0.85rem; color: var(--text-secondary);">
                    ${
                      activity.details.userName
                        ? `${activity.details.userName} - `
                        : ""
                    }${activity.details.course || ""}
                  </div>
                </div>
                <div style="font-size: 0.8rem; color: var(--text-secondary); white-space: nowrap;">
                  ${timeAgo}
                </div>
              </div>
            `;
            })
            .join("");
        }

        // Get activity icon
        getActivityIcon(action) {
          const icons = {
            "Nouvelle inscription": "user-plus",
            "Utilisateur supprimé": "user-times",
            "Données exportées": "download",
            "Système actualisé": "sync-alt",
            "Filtres appliqués": "filter",
            "Admin connecté": "shield-alt",
            default: "info-circle",
          };
          return icons[action] || icons.default;
        }

        // Get activity color
        getActivityColor(action) {
          const colors = {
            "Nouvelle inscription": "#10b981",
            "Utilisateur supprimé": "#ef4444",
            "Données exportées": "#3b82f6",
            "Système actualisé": "#8b5cf6",
            "Filtres appliqués": "#f59e0b",
            "Admin connecté": "#06b6d4",
            default: "#6b7280",
          };
          return colors[action] || colors.default;
        }

        // Get time ago string
        getTimeAgo(date) {
          const now = new Date();
          const diffInSeconds = Math.floor((now - date) / 1000);

          if (diffInSeconds < 60) return "Il y a quelques secondes";
          if (diffInSeconds < 3600)
            return `Il y a ${Math.floor(diffInSeconds / 60)} min`;
          if (diffInSeconds < 86400)
            return `Il y a ${Math.floor(diffInSeconds / 3600)}h`;
          return `Il y a ${Math.floor(diffInSeconds / 86400)} jour${
            Math.floor(diffInSeconds / 86400) > 1 ? "s" : ""
          }`;
        }

        // Clear activity log
        clearActivityLog() {
          if (
            !confirm(
              "Êtes-vous sûr de vouloir effacer tout l'historique d'activité ?"
            )
          )
            return;

          this.activityLog = [];
          this.saveActivityLog();
          this.refreshActivityFeed();
          this.showNotification("Historique d'activité effacé", "success");
        }

        // Refresh activity log (for manual refresh button)
        refreshActivityLog() {
          this.logActivity("Système actualisé", {
            timestamp: new Date().toISOString(),
          });
          this.showNotification("Activité actualisée", "success");
        }

        // Initialize all charts
        initializeCharts() {
          this.initializeRegistrationTrendsChart();
          this.initializePaymentMethodsChart();
          this.initializeCoursePopularityChart();
        }

        // Initialize registration trends chart
        initializeRegistrationTrendsChart() {
          const ctx = document.getElementById("registrationTrendsChart");
          if (!ctx) return;

          const last7Days = this.getLast7DaysData();

          this.charts.registrationTrends = new Chart(ctx, {
            type: "line",
            data: {
              labels: last7Days.labels,
              datasets: [
                {
                  label: "Inscriptions par jour",
                  data: last7Days.data,
                  borderColor: "#3b82f6",
                  backgroundColor: "rgba(59, 130, 246, 0.1)",
                  tension: 0.4,
                  fill: true,
                  pointBackgroundColor: "#3b82f6",
                  pointBorderColor: "#ffffff",
                  pointBorderWidth: 2,
                  pointRadius: 5,
                },
              ],
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  labels: {
                    color: "#ffffff",
                  },
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    color: "#9ca3af",
                    stepSize: 1,
                  },
                  grid: {
                    color: "rgba(156, 163, 175, 0.1)",
                  },
                },
                x: {
                  ticks: {
                    color: "#9ca3af",
                  },
                  grid: {
                    color: "rgba(156, 163, 175, 0.1)",
                  },
                },
              },
            },
          });
        }

        // Initialize payment methods chart
        initializePaymentMethodsChart() {
          const ctx = document.getElementById("paymentMethodsChart");
          if (!ctx) return;

          const paymentData = this.getPaymentMethodsData();

          this.charts.paymentMethods = new Chart(ctx, {
            type: "doughnut",
            data: {
              labels: paymentData.labels,
              datasets: [
                {
                  data: paymentData.data,
                  backgroundColor: [
                    "#3b82f6", // Blue
                    "#10b981", // Green
                    "#f59e0b", // Yellow
                    "#ef4444", // Red
                    "#8b5cf6", // Purple
                    "#06b6d4", // Cyan
                  ],
                  borderColor: "#1f2937",
                  borderWidth: 2,
                },
              ],
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: "bottom",
                  labels: {
                    color: "#ffffff",
                    padding: 20,
                    usePointStyle: true,
                  },
                },
              },
            },
          });
        }

        // Initialize course popularity chart
        initializeCoursePopularityChart() {
          const ctx = document.getElementById("coursePopularityChart");
          if (!ctx) return;

          const courseData = this.getCoursePopularityData();

          this.charts.coursePopularity = new Chart(ctx, {
            type: "bar",
            data: {
              labels: courseData.labels,
              datasets: [
                {
                  label: "Nombre d'inscriptions",
                  data: courseData.data,
                  backgroundColor: [
                    "rgba(59, 130, 246, 0.8)",
                    "rgba(16, 185, 129, 0.8)",
                    "rgba(245, 158, 11, 0.8)",
                    "rgba(239, 68, 68, 0.8)",
                    "rgba(139, 92, 246, 0.8)",
                  ],
                  borderColor: [
                    "#3b82f6",
                    "#10b981",
                    "#f59e0b",
                    "#ef4444",
                    "#8b5cf6",
                  ],
                  borderWidth: 2,
                  borderRadius: 8,
                  borderSkipped: false,
                },
              ],
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  labels: {
                    color: "#ffffff",
                  },
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    color: "#9ca3af",
                    stepSize: 1,
                  },
                  grid: {
                    color: "rgba(156, 163, 175, 0.1)",
                  },
                },
                x: {
                  ticks: {
                    color: "#9ca3af",
                  },
                  grid: {
                    display: false,
                  },
                },
              },
            },
          });
        }

        // Get last 7 days registration data
        getLast7DaysData() {
          const labels = [];
          const data = [];
          const today = new Date();

          for (let i = 6; i >= 0; i--) {
            const date = new Date(today);
            date.setDate(date.getDate() - i);
            const dateStr = date.toISOString().split("T")[0];

            labels.push(
              date.toLocaleDateString("fr-FR", {
                weekday: "short",
                day: "numeric",
              })
            );

            const count = this.users.filter((user) => {
              const userDate = new Date(user.registrationDate)
                .toISOString()
                .split("T")[0];
              return userDate === dateStr;
            }).length;

            data.push(count);
          }

          return { labels, data };
        }

        // Get payment methods data
        getPaymentMethodsData() {
          const paymentCounts = {};

          this.users.forEach((user) => {
            const method = user.paymentMethod || "Inconnu";
            paymentCounts[method] = (paymentCounts[method] || 0) + 1;
          });

          return {
            labels: Object.keys(paymentCounts),
            data: Object.values(paymentCounts),
          };
        }

        // Get course popularity data
        getCoursePopularityData() {
          const courseCounts = {};

          this.users.forEach((user) => {
            const course = user.course || "Inconnu";
            courseCounts[course] = (courseCounts[course] || 0) + 1;
          });

          // Sort by popularity
          const sortedCourses = Object.entries(courseCounts).sort(
            ([, a], [, b]) => b - a
          );

          return {
            labels: sortedCourses.map(([course]) => course),
            data: sortedCourses.map(([, count]) => count),
          };
        }

        // Update all charts with new data
        updateCharts() {
          // Update registration trends
          if (this.charts.registrationTrends) {
            const trendsData = this.getLast7DaysData();
            this.charts.registrationTrends.data.labels = trendsData.labels;
            this.charts.registrationTrends.data.datasets[0].data =
              trendsData.data;
            this.charts.registrationTrends.update();
          }

          // Update payment methods
          if (this.charts.paymentMethods) {
            const paymentData = this.getPaymentMethodsData();
            this.charts.paymentMethods.data.labels = paymentData.labels;
            this.charts.paymentMethods.data.datasets[0].data = paymentData.data;
            this.charts.paymentMethods.update();
          }

          // Update course popularity
          if (this.charts.coursePopularity) {
            const courseData = this.getCoursePopularityData();
            this.charts.coursePopularity.data.labels = courseData.labels;
            this.charts.coursePopularity.data.datasets[0].data =
              courseData.data;
            this.charts.coursePopularity.update();
          }
        }

        // Show notification
        showNotification(message, type = "info") {
          const notification = document.createElement("div");
          notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            animation: slideInRight 0.3s ease;
            background: ${
              type === "success"
                ? "var(--success-color)"
                : type === "warning"
                ? "var(--warning-color)"
                : type === "error"
                ? "var(--error-color)"
                : "var(--info-color)"
            };
          `;

          notification.innerHTML = `
            <i class="fas fa-${
              type === "success"
                ? "check-circle"
                : type === "warning"
                ? "exclamation-triangle"
                : type === "error"
                ? "times-circle"
                : "info-circle"
            }"></i>
            ${message}
          `;

          document.body.appendChild(notification);

          setTimeout(() => {
            notification.remove();
          }, 3000);
        }

        // Initialize event listeners
        initializeEventListeners() {
          // Store initial user count for comparison
          this.lastUserCount = this.users.length;

          // Listen for storage events (when payment form adds a user)
          window.addEventListener("storage", (e) => {
            if (e.key === "mdai_users") {
              const oldCount = this.users.length;
              this.users = this.loadUsers();
              this.filteredUsers = [...this.users];
              const newCount = this.users.length;

              if (newCount > oldCount) {
                const newUser = this.users[newCount - 1];
                this.logActivity("Nouvelle inscription", {
                  userName: newUser.name,
                  course: newUser.course,
                  amount: newUser.amount,
                  paymentMethod: newUser.paymentMethod,
                });
                this.showNotification(
                  `Nouveau utilisateur: ${newUser.name} - ${newUser.course}`,
                  "success"
                );
              }

              this.refreshDashboard();
            }
          });

          // Listen for custom events from payment form
          window.addEventListener("userAdded", (e) => {
            const oldCount = this.users.length;
            this.users = this.loadUsers();
            const newCount = this.users.length;

            if (newCount > oldCount) {
              const newUser = this.users[newCount - 1];
              this.showNotification(
                `Nouveau utilisateur ajouté: ${newUser.name}`,
                "success"
              );
            }

            this.refreshDashboard();
          });

          // Periodic check for new users (every 10 seconds)
          setInterval(() => {
            const currentUsers = this.loadUsers();
            if (currentUsers.length > this.lastUserCount) {
              const newUsersCount = currentUsers.length - this.lastUserCount;
              this.users = currentUsers;
              this.filteredUsers = [...this.users];
              this.lastUserCount = currentUsers.length;
              this.refreshDashboard();

              if (newUsersCount === 1) {
                const newUser = currentUsers[currentUsers.length - 1];
                this.logActivity("Nouvelle inscription", {
                  userName: newUser.name,
                  course: newUser.course,
                  source: "Auto-détection",
                });
                this.showNotification(
                  `Nouvel utilisateur détecté: ${newUser.name}`,
                  "info"
                );
              } else {
                this.logActivity("Nouvelles inscriptions", {
                  count: newUsersCount,
                  source: "Auto-détection",
                });
                this.showNotification(
                  `${newUsersCount} nouveaux utilisateurs détectés`,
                  "info"
                );
              }
            }
            this.lastUserCount = currentUsers.length;
          }, 10000);
        }
      }

      // Navigation and Section Management
      document.addEventListener("DOMContentLoaded", function () {
        // UserManager will be initialized after successful authentication

        const navLinks = document.querySelectorAll(".nav-link");
        const sections = {
          Dashboard: "dashboard-section",
          Utilisateurs: "users-section",
          Cours: "courses-section",
          Analytiques: "analytics-section",
          Paramètres: "settings-section",
        };

        navLinks.forEach((link) => {
          link.addEventListener("click", function (e) {
            e.preventDefault();

            // Remove active class from all links
            navLinks.forEach((l) => l.classList.remove("active"));

            // Add active class to clicked link
            this.classList.add("active");

            // Update page title and show relevant section
            const pageTitle = document.querySelector(".page-title");
            const sectionName = this.textContent.trim();
            pageTitle.textContent = sectionName;

            // Hide all sections
            Object.values(sections).forEach((sectionId) => {
              const section = document.getElementById(sectionId);
              if (section) section.style.display = "none";
            });

            // Show selected section
            const targetSection = sections[sectionName];
            if (targetSection) {
              const section = document.getElementById(targetSection);
              if (section) {
                section.style.display = "block";
                // Refresh data when showing users section
                if (targetSection === "users-section") {
                  userManager.refreshDashboard();
                }
              }
            }
          });
        });

        // Mobile sidebar toggle
        const sidebar = document.querySelector(".sidebar");

        if (window.innerWidth <= 768) {
          const mobileMenuBtn = document.createElement("button");
          mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
          mobileMenuBtn.style.cssText = `
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px;
            border-radius: var(--radius-md);
            cursor: pointer;
          `;

          document.body.appendChild(mobileMenuBtn);

          mobileMenuBtn.addEventListener("click", () => {
            sidebar.classList.toggle("active");
          });
        }

        // Auto-refresh every 30 seconds
        setInterval(() => {
          userManager.refreshDashboard();
        }, 30000);
      });

      // Global functions for button actions
      function refreshUsers() {
        userManager.refreshDashboard();
        userManager.showNotification("Données actualisées", "success");
      }

      function exportUsers() {
        userManager.exportUsers();
      }

      // CSS animations
      const style = document.createElement("style");
      style.textContent = `
        @keyframes slideInRight {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }

        /* Settings Page Styles */
        .settings-group {
          border-bottom: 1px solid var(--border-color);
          padding-bottom: var(--spacing-lg);
        }

        .settings-group:last-child {
          border-bottom: none;
          padding-bottom: 0;
        }

        /* Toggle Switch Styles */
        .switch {
          position: relative;
          display: inline-block;
          width: 50px;
          height: 24px;
        }

        .switch input {
          opacity: 0;
          width: 0;
          height: 0;
        }

        .slider {
          position: absolute;
          cursor: pointer;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: var(--border-color);
          transition: 0.3s ease;
          border-radius: 24px;
        }

        .slider:before {
          position: absolute;
          content: "";
          height: 18px;
          width: 18px;
          border-radius: 50%;
          left: 3px;
          bottom: 3px;
          background-color: white;
          transition: 0.3s ease;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input:checked + .slider {
          background-color: var(--primary-color);
        }

        input:checked + .slider:before {
          transform: translateX(26px);
        }

        input:focus + .slider {
          box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }

        /* Compact Mode Styles */
        .compact-mode .table {
          font-size: 0.85rem;
        }

        .compact-mode .table th,
        .compact-mode .table td {
          padding: 8px 12px;
        }

        .compact-mode .stat-card {
          padding: var(--spacing-sm);
        }

        .compact-mode .stat-number {
          font-size: 1.5rem;
        }

        .compact-mode .card {
          margin-bottom: var(--spacing-md);
        }

        /* Enhanced Animation Styles */
        * {
          transition-duration: var(--transition-speed, 0.3s);
        }

        .settings-group {
          transition: all 0.3s ease;
        }

        .settings-group:hover {
          background: rgba(255, 255, 255, 0.01);
          border-radius: var(--radius-md);
          padding: var(--spacing-md);
          margin: -var(--spacing-md);
        }

        /* Advanced Button Styles */
        .btn {
          position: relative;
          overflow: hidden;
        }

        .btn::before {
          content: '';
          position: absolute;
          top: 50%;
          left: 50%;
          width: 0;
          height: 0;
          background: rgba(255, 255, 255, 0.1);
          border-radius: 50%;
          transform: translate(-50%, -50%);
          transition: width 0.3s, height 0.3s;
        }

        .btn:hover::before {
          width: 300px;
          height: 300px;
        }

        /* Performance Monitor Styles */
        .performance-metric {
          transition: all 0.3s ease;
        }

        .performance-metric:hover {
          transform: scale(1.05);
        }
      `;
      document.head.appendChild(style);
    </script>
  </body>
</html>

